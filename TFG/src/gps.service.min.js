(function(){"use strict";function t(){var t=this;t.cont=0,t.trackActivo=0,t.rutaActiva=0,t.wpActivo=0,t.tracks=[],t.rutas=[],t.waypoints=[],t.markers=[],t.puntosTrackActivo=[],t.distancias2=[],t.elevaciones2=[],t.distancias=[],t.elevaciones=[],t.tienePoly=[],t.tienePolyR=[],t.polyLineas=[],t.polyLineasR=[],t.isTrack=!1,t.isWaypoint,t.hayEntidadesCreadas=!1,t.elevacion=0,t.distancia=0,t.latitud=0,t.longitud=0,t.markersT=[],t.wpRta=[],t.velocidad=4,t.modoCreacion=!1,t.latitudPInv=0,t.longitudPInv=0,t.elevacionP=0,t.modoInvertir=!1,t.mapa,t.seleccion=!1,t.latitudSelec=0,t.longitudSelec=0,t.markerPunto,t.puntoElegido,t.modoRecorte1=!1,t.modoRecorte2=!1,t.colorPolyNF="",t.modoUnion=!1,t.modoInsertar=!1,t.puntoN={},t.xmlImportado,t.modoImportWP=!1,t.puntoborrado=!1,t.isTrackImport=!1,t.isRuteImport=!1,t.isWpImport=!1,t.puntosGrafico=[],t.modoEdicion=!1,t.conection=!1,t.ver=!0,t.modoInsertarWp=!1,t.elevacionPtAnadido=0,t.segundosAnadir=0,t.clicTabGraf=!1,t.cuadricula=!0,t.fin=!1,t.mapas=[],t.colorGrafica="#0062ff",t.infowindow2,t.ownerDo,t.trackNombre,t.rutaNombre,t.wptNombre,t.trackElegidoFinal=-1,t.trackElegidoInicial=-1,t.trackElegidoFinalMarker,t.trackElegidoInicialMarker,t.rutaElegidoFinal=-1,t.rutaElegidoInicial=-1,t.rutaElegidoFinalMarker,t.rutaElegidoInicialMarker,t.polisCuadricula=[],t.coords=!1,t.actuEle=!1,t.elevator,t.puntos=new Array,t.myIcon={path:google.maps.SymbolPath.CIRCLE,scale:3,strokeColor:"#000000",fillColor:"yellow",strokeOpacity:1,strokeWeight:2},t.myIconR={path:google.maps.SymbolPath.CIRCLE,scale:3,strokeColor:"#0C090C",fillColor:"yellow",strokeOpacity:1,strokeWeight:3},t.myIconRIni={path:google.maps.SymbolPath.CIRCLE,scale:6,strokeColor:"#FE0006",fillColor:"yellow",strokeOpacity:1,strokeWeight:3},t.myIconRFin={path:google.maps.SymbolPath.CIRCLE,scale:6,strokeColor:"#033FC9",fillColor:"yellow",strokeOpacity:1,strokeWeight:3},t.changedColorR=function(a){var o={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:a,strokeOpacity:.7,strokeWeight:2.9,scale:2.7},e={icon:o,offset:"50%",repeat:"80px"};t.getPolyR(t.rutaNombre).setOptions({strokeColor:a,icons:[e]})},t.changedColor=function(a){var o={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:a,strokeOpacity:.7,strokeWeight:2.9,scale:2.7},e={icon:o,offset:"50%",repeat:"80px"};t.getPolyR(t.trackNombre).setOptions({strokeColor:a,icons:[e]})},t.superponerPolylineaR=function(){for(var a in t.polyLineasR)t.polyLineasR[a].setOptions({zIndex:1});void 0!=t.getPoly()&&t.getPoly().setOptions({zIndex:4})},t.superponerPolylinea=function(){for(var a in t.polyLineas)t.polyLineas[a].setOptions({zIndex:1});void 0!=t.getPoly()&&t.getPoly().setOptions({zIndex:4})},t.aleatorio=function(t,a){var o=a-t,e=Math.random()*o;return e=Math.floor(e),parseInt(t)+e},t.colorAleatorio=function(){for(var a=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"),o="#",e=0;e<6;e++){var r=t.aleatorio(0,a.length);o+=a[r]}return o},t.centrarMapa=function(){var a=new google.maps.LatLngBounds;for(var o in t.tracks[t.tracks.length-1].puntos){var e=new google.maps.LatLng(t.tracks[t.tracks.length-1].puntos[o].latitud,t.tracks[t.tracks.length-1].puntos[o].longitud);a.extend(e)}t.mapa.setCenter(a.getCenter()),t.mapa.setZoom(t.getZoomByBounds(t.mapa,a))},t.centrarRuta=function(){var a=new google.maps.LatLngBounds;for(var o in t.rutas[t.rutas.length-1].puntos){var e=new google.maps.LatLng(t.rutas[t.rutas.length-1].puntos[o].latitud,t.rutas[t.rutas.length-1].puntos[o].longitud);a.extend(e)}t.mapa.setCenter(a.getCenter()),t.mapa.setZoom(t.getZoomByBounds(t.mapa,a))},t.centrarWP=function(){var a=t.xmlImportado.getElementsByTagName("wpt"),o=new google.maps.LatLngBounds;for(var e in a)if(e<a.length){var r=new google.maps.LatLng(a[e].attributes.lat.nodeValue,a[e].attributes.lon.nodeValue);o.extend(r)}t.mapa.setCenter(o.getCenter()),t.mapa.setZoom(t.getZoomByBounds(t.mapa,o))},t.getZoomByBounds=function(t,a){for(var o=t.mapTypes.get(t.getMapTypeId()).maxZoom||21,e=t.mapTypes.get(t.getMapTypeId()).minZoom||0,r=t.getProjection().fromLatLngToPoint(a.getNorthEast()),n=t.getProjection().fromLatLngToPoint(a.getSouthWest()),i=Math.abs(r.x-n.x),c=Math.abs(r.y-n.y),s=40,l=o;l>=e;--l)if(i*(1<<l)+2*s<$(t.getDiv()).width()&&c*(1<<l)+2*s<$(t.getDiv()).height())return l;return 0},t.importXMLWp=function(){var a=t.xmlImportado.getElementsByTagName("wpt");t.modoImportWP=!0;for(var o in a)if(o<a.length){t.longitudPInv=a[o].attributes.lon.nodeValue,t.latitudPInv=a[o].attributes.lat.nodeValue,t.elevacionP=parseFloat(a[o].firstElementChild.textContent),google.maps.event.trigger(t.mapa,"click");var e=a[o].getElementsByTagName("name")[0];e=void 0==e?"Nuevo Waypoint":e.textContent,t.waypoints[t.waypoints.length-1].nombre=e}t.modoImportWP=!1},t.importXML=function(){var a=t.xmlImportado.getElementsByTagName("trkpt"),o=t.xmlImportado.getElementsByTagName("trk")[0].getElementsByTagName("name")[0];o=void 0==o?"Nuevo Track":o.textContent,console.log(o),t.modoInvertir=!0;for(var e in a)e<a.length&&(t.longitudPInv=a[e].attributes.lon.nodeValue,t.latitudPInv=a[e].attributes.lat.nodeValue,t.elevacionP=parseFloat(a[e].firstElementChild.textContent),void 0==t.elevacionP&&(t.elevacionP=0),t.elevacionP=t.elevacionP.toFixed(2),t.modoRecorte2=!0,google.maps.event.trigger(t.mapa,"click"));t.tracks[t.tracks.length-1].nombre=o,t.modoInvertir=!1,t.modoRecorte2=!1},t.importXMLRuta=function(){var a=t.xmlImportado.getElementsByTagName("rtept"),o=t.xmlImportado.getElementsByTagName("rte")[0].firstElementChild;console.log(o),o=void 0==o||"rtept"==o.tagName?"Nueva Ruta":o.textContent,t.modoInvertir=!0;for(var e in a)e<a.length&&(t.longitudPInv=a[e].attributes.lon.nodeValue,t.latitudPInv=a[e].attributes.lat.nodeValue,t.elevacionP=parseFloat(a[e].firstElementChild.textContent),t.modoRecorte2=!0,google.maps.event.trigger(t.mapa,"click"));t.rutas[t.rutas.length-1].nombre=o,t.modoInvertir=!1,t.modoRecorte2=!1;var r={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.colorPoly(),strokeOpacity:.7,strokeWeight:2.9,scale:2.7},n={icon:r,offset:"50%",repeat:"80px"};t.getPoly().setOptions({strokeColor:r.strokeColor,icons:[n]})},t.getWaypoints=function(){var a='<?xml version="1.0" encoding="UTF-8"?>\n<gpx xmlns="http://www.topografix.com/GPX/1/1" creator="Alejandro Fernández Herrero" version="1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n\t<metadata>\n\t\t<name>TFG Tracks GPS</name>\n\t\t<link href="https://h3rrero.github.io/TFG-GPS/">\n\t\t\t<text>TFG-GPS</text>\n\t\t</link>\n\t</metadata>\n';for(var o in t.waypoints)a=a+'\t<wpt lat="'+t.waypoints[o].latitud+'" lon="'+t.waypoints[o].longitud+'">\n\t\t<ele>'+t.waypoints[o].elevacion+"</ele>\n\t\t<name>"+t.waypoints[o].nombre+"</name>\n\t\t<desc>"+t.waypoints[o].descripcion+"</desc>\n\t\t<sym>generic</sym>\n\t\t<type>Generic</type>\n\t</wpt>\n";return a+="</gpx>"},t.getXml=function(a){var o='<?xml version="1.0" encoding="UTF-8"?>\n<gpx xmlns="http://www.topografix.com/GPX/1/1" creator="Alejandro Fernández Herrero" version="1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n\t<metadata>\n\t\t<name>TFG Tracks GPS</name>\n\t\t<link href="https://h3rrero.github.io/TFG-GPS/">\n\t\t\t<text>TFG-GPS</text>\n\t\t</link>\n\t</metadata>\n';if(1==a){o=o+"\t<trk>\n\t\t<name>"+t.tracks[t.trackActivo].nombre+"</name>\n\t\t<trkseg>\n";for(var e in t.tracks[t.trackActivo].puntos)o=o+'\t\t\t<trkpt lat="'+t.tracks[t.trackActivo].puntos[e].latitud+'" lon="'+t.tracks[t.trackActivo].puntos[e].longitud+'">\n\t\t\t\t<ele>'+t.tracks[t.trackActivo].puntos[e].elevacion+"</ele>\n\t\t\t\t<time>"+t.tracks[t.trackActivo].puntos[e].fecha+"T"+t.tracks[t.trackActivo].puntos[e].hora+"</time>\n\t\t\t</trkpt>\n";o+="\t\t</trkseg>\n\t</trk>\n</gpx>"}else{o=o+"\t<rte>\n\t\t<name>"+t.rutas[t.rutaActiva].nombre+"</name>\n";for(var e in t.rutas[t.rutaActiva].puntos)o=o+'\t<rtept lat="'+t.rutas[t.rutaActiva].puntos[e].latitud+'" lon="'+t.rutas[t.rutaActiva].puntos[e].longitud+'">\n\t\t<ele>'+t.rutas[t.rutaActiva].puntos[e].elevacion+"</ele>\n\t\t<name>Waypoint de ruta Nº"+e+"</name>\n\t\t<desc>prueba</desc>\n\t\t<sym>generic</sym>\n\t\t<type>Generic</type>\n\t</rtept>\n";o+="\t</rte>\n</gpx>"}return o},t.anadirPuntoRuta2=function(a){setTimeout(function(){t.puntoN.elevacion=t.elevacionPtAnadido;var o=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)].latitud,t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)].longitud),e=new google.maps.LatLng(t.puntoN.latitud,t.puntoN.longitud),r=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)+1].latitud,t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)+1].longitud);t.puntoN.distancia=google.maps.geometry.spherical.computeDistanceBetween(o,e).toFixed(2),t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)+1].distancia=google.maps.geometry.spherical.computeDistanceBetween(e,r).toFixed(2),t.puntoN.desnivel=(t.puntoN.elevacion-t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)].elevacion).toFixed(2),t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)+1].desnivel=(t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)+1].elevacion-t.puntoN.elevacion).toFixed(2),t.getPoly().getPath().insertAt(parseInt(t.puntoElegido)+1,new google.maps.LatLng(t.puntoN.latitud,t.puntoN.longitud)),t.wpRta[t.rutaActiva].splice(parseInt(t.puntoElegido)+1,0,a),t.rutas[t.rutaActiva].puntos.splice(parseInt(t.puntoElegido)+1,0,t.puntoN),t.puntosTrackActivo=t.rutas[t.rutaActiva].puntos,t.rutas[t.rutaActiva].fecha=new Date,t.rutas[t.rutaActiva].distancia=0,t.rutas[t.rutaActiva].desnivelP=0,t.rutas[t.rutaActiva].desnivelN=0,t.rutas[t.rutaActiva].elevMax=0,t.rutas[t.rutaActiva].elevMin=9999999;for(var n in t.rutas[t.rutaActiva].puntos)t.rutas[t.rutaActiva].puntos[n].numero=n,t.calcularDatosTrack(1,t.rutas[t.rutaActiva].puntos[n],t.rutaActiva)},10)},t.moverPuntoRuta2=function(a,o,e,r){if(t.getPoly().getPath().setAt(a,new google.maps.LatLng(e,o)),t.rutas[t.rutaActiva].puntos[a].latitud=e,t.rutas[t.rutaActiva].puntos[a].longitud=o,t.rutas[t.rutaActiva].puntos[a].elevacion=r,t.puntosTrackActivo=t.rutas[t.rutaActiva].puntos,0==a){var n=new google.maps.LatLng(e,o),i=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(a)+1].latitud,t.rutas[t.rutaActiva].puntos[parseInt(a)+1].longitud);t.rutas[t.rutaActiva].puntos[parseInt(a)+1].distancia=google.maps.geometry.spherical.computeDistanceBetween(n,i).toFixed(2),t.rutas[t.rutaActiva].puntos[parseInt(a)+1].desnivel=(t.rutas[t.rutaActiva].puntos[parseInt(a)+1].elevacion-r).toFixed(2)}else if(a==t.rutas[t.rutaActiva].puntos.length-1){var c=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(a)-1].latitud,t.rutas[t.rutaActiva].puntos[parseInt(a)-1].longitud),n=new google.maps.LatLng(e,o);t.rutas[t.rutaActiva].puntos[a].distancia=google.maps.geometry.spherical.computeDistanceBetween(c,n).toFixed(2),t.rutas[t.rutaActiva].puntos[a].desnivel=(r-t.rutas[t.rutaActiva].puntos[parseInt(a)-1].elevacion).toFixed(2)}else{var c=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(a)-1].latitud,t.rutas[t.rutaActiva].puntos[parseInt(a)-1].longitud),n=new google.maps.LatLng(e,o),i=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(a)+1].latitud,t.rutas[t.rutaActiva].puntos[parseInt(a)+1].longitud);t.rutas[t.rutaActiva].puntos[a].distancia=google.maps.geometry.spherical.computeDistanceBetween(c,n).toFixed(2),t.rutas[t.rutaActiva].puntos[parseInt(a)+1].distancia=google.maps.geometry.spherical.computeDistanceBetween(n,i).toFixed(2),t.rutas[t.rutaActiva].puntos[a].desnivel=(r-t.rutas[t.rutaActiva].puntos[parseInt(a)-1].elevacion).toFixed(2),t.rutas[t.rutaActiva].puntos[parseInt(a)+1].desnivel=(t.rutas[t.rutaActiva].puntos[parseInt(a)+1].elevacion-r).toFixed(2)}t.rutas[t.rutaActiva].fecha=new Date,t.rutas[t.rutaActiva].distancia=0,t.rutas[t.rutaActiva].desnivelP=0,t.rutas[t.rutaActiva].desnivelN=0,t.rutas[t.rutaActiva].elevMax=0,t.rutas[t.rutaActiva].elevMin=9999999;for(var s in t.rutas[t.rutaActiva].puntos)t.calcularDatosTrack(1,t.rutas[t.rutaActiva].puntos[s],t.rutaActiva);t.actualizarPuntosR()},t.moverPuntoTrack2=function(a,o,e,r){if(t.getPoly().getPath().setAt(a,new google.maps.LatLng(e,o)),t.tracks[t.trackActivo].puntos[a].latitud=e,t.tracks[t.trackActivo].puntos[a].longitud=o,t.tracks[t.trackActivo].puntos[a].elevacion=r,t.puntosTrackActivo=t.tracks[t.trackActivo].puntos,0==a){var n=new google.maps.LatLng(e,o),i=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(a)+1].latitud,t.tracks[t.trackActivo].puntos[parseInt(a)+1].longitud);t.tracks[t.trackActivo].puntos[parseInt(a)+1].distancia=google.maps.geometry.spherical.computeDistanceBetween(n,i).toFixed(2),t.tracks[t.trackActivo].puntos[parseInt(a)+1].desnivel=(t.tracks[t.trackActivo].puntos[parseInt(a)+1].elevacion-r).toFixed(2)}else if(a==t.tracks[t.trackActivo].puntos.length-1){var c=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(a)-1].latitud,t.tracks[t.trackActivo].puntos[parseInt(a)-1].longitud),n=new google.maps.LatLng(e,o);t.tracks[t.trackActivo].puntos[a].distancia=google.maps.geometry.spherical.computeDistanceBetween(c,n).toFixed(2),t.tracks[t.trackActivo].puntos[a].desnivel=(r-t.tracks[t.trackActivo].puntos[parseInt(a)-1].elevacion).toFixed(2)}else{var c=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(a)-1].latitud,t.tracks[t.trackActivo].puntos[parseInt(a)-1].longitud),n=new google.maps.LatLng(e,o),i=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(a)+1].latitud,t.tracks[t.trackActivo].puntos[parseInt(a)+1].longitud);t.tracks[t.trackActivo].puntos[a].distancia=google.maps.geometry.spherical.computeDistanceBetween(c,n).toFixed(2),t.tracks[t.trackActivo].puntos[parseInt(a)+1].distancia=google.maps.geometry.spherical.computeDistanceBetween(n,i).toFixed(2),t.tracks[t.trackActivo].puntos[a].desnivel=(r-t.tracks[t.trackActivo].puntos[parseInt(a)-1].elevacion).toFixed(2),t.tracks[t.trackActivo].puntos[parseInt(a)+1].desnivel=(t.tracks[t.trackActivo].puntos[parseInt(a)+1].elevacion-r).toFixed(2)}t.tracks[t.trackActivo].fecha=new Date,t.tracks[t.trackActivo].distancia=0,t.tracks[t.trackActivo].desnivelP=0,t.tracks[t.trackActivo].desnivelN=0,t.tracks[t.trackActivo].elevMax=0,t.tracks[t.trackActivo].elevMin=9999999,t.tracks[t.trackActivo].duracionIda=0,t.tracks[t.trackActivo].duracionVuelta=0;for(var s in t.tracks[t.trackActivo].puntos)t.calcularDatosTrack(0,t.tracks[t.trackActivo].puntos[s],t.trackActivo),t.tracks[t.trackActivo].duracionIda=parseFloat(t.calcularDuracion(!0,t.trackActivo)).toFixed(2),t.tracks[t.trackActivo].duracionVuelta=parseFloat(t.calcularDuracion(!1,t.trackActivo)).toFixed(2),t.calcularFecha(t.trackActivo,t.calcularDuracionPuntos(t.tracks[t.trackActivo].puntos[s])),t.tracks[t.trackActivo].puntos[s].fecha=t.tracks[t.trackActivo].fecha.getDate()+"/"+t.tracks[t.trackActivo].fecha.getMonth()+"/"+t.tracks[t.trackActivo].fecha.getFullYear(),t.tracks[t.trackActivo].puntos[s].hora=t.tracks[t.trackActivo].fecha.getHours()+":"+t.ordenarMinutos();t.actualizarPuntosT()},t.anadirPuntoTrack2=function(a){setTimeout(function(){t.puntoN.elevacion=t.elevacionPtAnadido;var o=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)].latitud,t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)].longitud),e=new google.maps.LatLng(t.puntoN.latitud,t.puntoN.longitud),r=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)+1].latitud,t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)+1].longitud);t.puntoN.distancia=google.maps.geometry.spherical.computeDistanceBetween(o,e).toFixed(2),t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)+1].distancia=google.maps.geometry.spherical.computeDistanceBetween(e,r).toFixed(2),t.puntoN.desnivel=(t.puntoN.elevacion-t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)].elevacion).toFixed(2),t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)+1].desnivel=(t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)+1].elevacion-t.puntoN.elevacion).toFixed(2),t.getPoly().getPath().insertAt(parseInt(t.puntoElegido)+1,new google.maps.LatLng(t.puntoN.latitud,t.puntoN.longitud)),t.markersT[t.trackActivo].splice(parseInt(t.puntoElegido)+1,0,a),t.tracks[t.trackActivo].puntos.splice(parseInt(t.puntoElegido)+1,0,t.puntoN),t.puntosTrackActivo=t.tracks[t.trackActivo].puntos,t.tracks[t.trackActivo].fecha=new Date,t.tracks[t.trackActivo].distancia=0,t.tracks[t.trackActivo].desnivelP=0,t.tracks[t.trackActivo].desnivelN=0,t.tracks[t.trackActivo].elevMax=0,t.tracks[t.trackActivo].elevMin=9999999,t.tracks[t.trackActivo].duracionIda=0,t.tracks[t.trackActivo].duracionVuelta=0;for(var n in t.tracks[t.trackActivo].puntos)t.tracks[t.trackActivo].puntos[n].numero=n,t.calcularDatosTrack(0,t.tracks[t.trackActivo].puntos[n],t.trackActivo),t.tracks[t.trackActivo].duracionIda=parseFloat(t.calcularDuracion(!0,t.trackActivo)).toFixed(2),t.tracks[t.trackActivo].duracionVuelta=parseFloat(t.calcularDuracion(!1,t.trackActivo)).toFixed(2),t.calcularFecha(t.trackActivo,t.calcularDuracionPuntos(t.tracks[t.trackActivo].puntos[n])),t.tracks[t.trackActivo].puntos[n].fecha=t.tracks[t.trackActivo].fecha.getDate()+"/"+t.tracks[t.trackActivo].fecha.getMonth()+"/"+t.tracks[t.trackActivo].fecha.getFullYear(),t.tracks[t.trackActivo].puntos[n].hora=t.tracks[t.trackActivo].fecha.getHours()+":"+t.ordenarMinutos()},10)},t.eliminarPuntoRuta2=function(){if(t.getPoly().getPath().removeAt(t.puntoElegido),t.wpRta[t.rutaActiva][t.puntoElegido].setMap(null),t.wpRta[t.rutaActiva].splice(t.puntoElegido,1),t.rutas[t.rutaActiva].puntos.splice(t.puntoElegido,1),t.puntosTrackActivo=t.rutas[t.rutaActiva].puntos,t.rutas[t.rutaActiva].puntos.length>0){if(0==t.puntoElegido)t.wpRta[t.rutaActiva][t.puntoElegido].setIcon(t.myIconRIni),t.wpRta[t.rutaActiva][t.puntoElegido].setVisible(!0),t.rutas[t.rutaActiva].puntos[t.puntoElegido].distancia=0,t.rutas[t.rutaActiva].puntos[t.puntoElegido].desnivel=0;else if(parseInt(t.puntoElegido)-1==t.rutas[t.rutaActiva].puntos.length-1&&t.rutas[t.rutaActiva].puntos.length>1)t.wpRta[t.rutaActiva][t.rutas[t.rutaActiva].puntos.length-1].setIcon(t.myIconRFin),t.wpRta[t.rutaActiva][t.rutas[t.rutaActiva].puntos.length-1].setVisible(!0);else if(t.rutas[t.rutaActiva].puntos.length>1){var a=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)-1].latitud,t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)-1].longitud),o=new google.maps.LatLng(t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)].latitud,t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)].longitud);t.rutas[t.rutaActiva].puntos[t.puntoElegido].distancia=google.maps.geometry.spherical.computeDistanceBetween(a,o).toFixed(2),t.rutas[t.rutaActiva].puntos[t.puntoElegido].desnivel=(t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)].elevacion-t.rutas[t.rutaActiva].puntos[parseInt(t.puntoElegido)-1].elevacion).toFixed(2)}t.rutas[t.rutaActiva].fecha=new Date,t.rutas[t.rutaActiva].distancia=0,t.rutas[t.rutaActiva].desnivelP=0,t.rutas[t.rutaActiva].desnivelN=0,t.rutas[t.rutaActiva].elevMax=0,t.rutas[t.rutaActiva].elevMin=9999999;for(var e in t.rutas[t.rutaActiva].puntos)t.calcularDatosTrack(1,t.rutas[t.rutaActiva].puntos[e],t.rutaActiva);t.actualizarPuntosR()}else t.wpRta[t.rutaActiva]=void 0},t.eliminarPuntoTrack2=function(){if(t.getPoly().getPath().removeAt(t.puntoElegido),t.markersT[t.trackActivo][t.puntoElegido].setMap(null),t.markersT[t.trackActivo].splice(t.puntoElegido,1),t.tracks[t.trackActivo].puntos.splice(t.puntoElegido,1),t.puntosTrackActivo=t.tracks[t.trackActivo].puntos,t.tracks[t.trackActivo].puntos.length>0){if(0==t.puntoElegido)t.markersT[t.trackActivo][t.puntoElegido].setIcon(t.myIconRIni),t.markersT[t.trackActivo][t.puntoElegido].setVisible(!0),t.tracks[t.trackActivo].puntos[t.puntoElegido].distancia=0,t.tracks[t.trackActivo].puntos[t.puntoElegido].desnivel=0;else if(parseInt(t.puntoElegido)-1==t.tracks[t.trackActivo].puntos.length-1&&t.tracks[t.trackActivo].puntos.length>1)t.markersT[t.trackActivo][t.tracks[t.trackActivo].puntos.length-1].setIcon(t.myIconRFin),t.markersT[t.trackActivo][t.tracks[t.trackActivo].puntos.length-1].setVisible(!0);else if(t.tracks[t.trackActivo].puntos.length>1){var a=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)-1].latitud,t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)-1].longitud),o=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)].latitud,t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)].longitud);t.tracks[t.trackActivo].puntos[t.puntoElegido].distancia=google.maps.geometry.spherical.computeDistanceBetween(a,o).toFixed(2),t.tracks[t.trackActivo].puntos[t.puntoElegido].desnivel=(t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)].elevacion-t.tracks[t.trackActivo].puntos[parseInt(t.puntoElegido)-1].elevacion).toFixed(2)}t.tracks[t.trackActivo].fecha=new Date,t.tracks[t.trackActivo].distancia=0,t.tracks[t.trackActivo].desnivelP=0,t.tracks[t.trackActivo].desnivelN=0,t.tracks[t.trackActivo].elevMax=0,t.tracks[t.trackActivo].elevMin=9999999,t.tracks[t.trackActivo].duracionIda=0,t.tracks[t.trackActivo].duracionVuelta=0;for(var e in t.tracks[t.trackActivo].puntos)t.calcularDatosTrack(0,t.tracks[t.trackActivo].puntos[e],t.trackActivo),t.tracks[t.trackActivo].duracionIda=parseFloat(t.calcularDuracion(!0,t.trackActivo)).toFixed(2),t.tracks[t.trackActivo].duracionVuelta=parseFloat(t.calcularDuracion(!1,t.trackActivo)).toFixed(2),t.calcularFecha(t.trackActivo,t.calcularDuracionPuntos(t.tracks[t.trackActivo].puntos[e])),t.tracks[t.trackActivo].puntos[e].fecha=t.tracks[t.trackActivo].fecha.getDate()+"/"+t.tracks[t.trackActivo].fecha.getMonth()+"/"+t.tracks[t.trackActivo].fecha.getFullYear(),t.tracks[t.trackActivo].puntos[e].hora=t.tracks[t.trackActivo].fecha.getHours()+":"+t.ordenarMinutos();t.actualizarPuntosT()}else t.markersT[t.trackActivo]=void 0},t.buscarRutaPorNombre=function(a){for(var o in t.tracks)if(t.rutas[o].nombre==a)return o;return null},t.buscarTrackPorNombre=function(a){for(var o in t.tracks)if(t.tracks[o].nombre==a)return o;return null},t.unirRuta=function(a,o){t.modoInvertir=!0;for(var e in t.rutas[o].puntos)t.longitudPInv=t.rutas[o].puntos[e].longitud,t.latitudPInv=t.rutas[o].puntos[e].latitud,t.elevacionP=t.rutas[o].puntos[e].elevacion,t.modoRecorte2=!0,google.maps.event.trigger(t.mapa,"click");for(var e in t.rutas[a].puntos)t.longitudPInv=t.rutas[a].puntos[e].longitud,t.latitudPInv=t.rutas[a].puntos[e].latitud,t.elevacionP=t.rutas[a].puntos[e].elevacion,google.maps.event.trigger(t.mapa,"click");setTimeout(function(){$("#lir"+(t.rutas.length-1))[0].style.color="#FF3399"},500),t.modoInvertir=!1,t.modoRecorte2=!1,t.rutaElegidoFinalMarker.setMap(null),t.rutaElegidoInicialMarker.setMap(null)},t.unirTrack=function(a,o){t.modoInvertir=!0;for(var e in t.tracks[o].puntos)t.longitudPInv=t.tracks[o].puntos[e].longitud,t.latitudPInv=t.tracks[o].puntos[e].latitud,t.elevacionP=t.tracks[o].puntos[e].elevacion,t.modoRecorte2=!0,google.maps.event.trigger(t.mapa,"click");for(var e in t.tracks[a].puntos)t.longitudPInv=t.tracks[a].puntos[e].longitud,t.latitudPInv=t.tracks[a].puntos[e].latitud,t.elevacionP=t.tracks[a].puntos[e].elevacion,google.maps.event.trigger(t.mapa,"click");setTimeout(function(){$("#li"+(t.tracks.length-1))[0].style.color="#FF3399"},500),t.modoInvertir=!1,t.modoRecorte2=!1,t.trackElegidoFinalMarker.setMap(null),t.trackElegidoInicialMarker.setMap(null)},t.recortarTrack=function(){for(var a in t.tracks[t.trackActivo].puntos)parseInt(a)<=parseInt(t.puntoElegido)&&(t.longitudPInv=t.tracks[t.trackActivo].puntos[a].longitud,t.latitudPInv=t.tracks[t.trackActivo].puntos[a].latitud,t.elevacionP=t.tracks[t.trackActivo].puntos[a].elevacion,t.modoInvertir=!0,t.modoRecorte1=!0,google.maps.event.trigger(t.mapa,"click")),t.modoRecorte1=!1,parseInt(a)>=parseInt(t.puntoElegido)&&(t.longitudPInv=t.tracks[t.trackActivo].puntos[a].longitud,t.latitudPInv=t.tracks[t.trackActivo].puntos[a].latitud,t.elevacionP=t.tracks[t.trackActivo].puntos[a].elevacion,t.modoInvertir=!0,t.modoRecorte2=!0,google.maps.event.trigger(t.mapa,"click"));setTimeout(function(){$("#li"+(t.trackActivo+1))[0].style.color="#00FF00",$("#li"+(t.trackActivo+2))[0].style.color="#FF3399"},500),t.fin=!0,t.modoInvertir=!1,t.modoRecorte1=!1,t.modoRecorte2=!1,t.puntoElegido=null},t.recortarRuta=function(){for(var a in t.rutas[t.rutaActiva].puntos)parseInt(a)<=parseInt(t.puntoElegido)&&(t.longitudPInv=t.rutas[t.rutaActiva].puntos[a].longitud,t.latitudPInv=t.rutas[t.rutaActiva].puntos[a].latitud,t.elevacionP=t.rutas[t.rutaActiva].puntos[a].elevacion,t.modoInvertir=!0,t.modoRecorte1=!0,google.maps.event.trigger(t.mapa,"click")),t.modoRecorte1=!1,parseInt(a)>=parseInt(t.puntoElegido)&&(t.longitudPInv=t.rutas[t.rutaActiva].puntos[a].longitud,t.latitudPInv=t.rutas[t.rutaActiva].puntos[a].latitud,t.elevacionP=t.rutas[t.rutaActiva].puntos[a].elevacion,t.modoInvertir=!0,t.modoRecorte2=!0,google.maps.event.trigger(t.mapa,"click"));setTimeout(function(){$("#lir"+(t.rutaActiva+1))[0].style.color="#00FF00",$("#lir"+(t.rutaActiva+2))[0].style.color="#FF3399"},500),t.modoInvertir=!1,t.modoRecorte1=!1,t.modoRecorte2=!1,t.puntoElegido=null},t.puntoSelecR=function(a){t.puntoElegido=a,t.seleccion=!0,t.latitudSelec=t.rutas[t.rutaActiva].puntos[a].latitud,t.longitudSelec=t.rutas[t.rutaActiva].puntos[a].longitud,google.maps.event.trigger(t.mapa,"click"),t.clicTabGraf&&(t.mapa.setCenter(new google.maps.LatLng(t.latitudSelec,t.longitudSelec)),t.mapa.setZoom(17)),t.seleccion=!1,t.clicTabGraf=!1},t.puntoSelec=function(a){t.puntoElegido=a,t.seleccion=!0,t.latitudSelec=t.tracks[t.trackActivo].puntos[a].latitud,t.longitudSelec=t.tracks[t.trackActivo].puntos[a].longitud,google.maps.event.trigger(t.mapa,"click"),t.clicTabGraf&&(t.mapa.setCenter(new google.maps.LatLng(t.latitudSelec,t.longitudSelec)),t.mapa.setZoom(17)),t.seleccion=!1,t.clicTabGraf=!1},t.cambiarDescripcion=function(a){t.waypoints[t.wptNombre].descripcion=a},t.renombrarT=function(a){1==t.isTrack&&(t.tracks[t.trackNombre].nombre=a)},t.anadirWaypoint=function(a,o){var e=new google.maps.LatLng(a,o);isNaN(e.lat())||isNaN(e.lng())||(t.latitud=parseFloat(a).toFixed(6),t.longitud=parseFloat(o).toFixed(6),t.modoInsertarWp=!0,google.maps.event.trigger(t.mapa,"click"),t.modoInsertarWp=!1)},t.grosorR=function(a){var o,e;o={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.getPolyR(t.rutaNombre).strokeColor,strokeOpacity:.7,strokeWeight:a,scale:2.7},e={icon:o,offset:"50%",repeat:"80px"};var r=t.getPolyR(t.rutaNombre);r.setOptions({strokeColor:t.getPolyR(t.rutaNombre).strokeColor,strokeOpacity:1,strokeWeight:a,icons:[e]})},t.grosor=function(a){var o,e;o={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.getPolyR(t.trackNombre).strokeColor,strokeOpacity:.7,strokeWeight:a,scale:2.7},e={icon:o,offset:"50%",repeat:"80px"};var r=t.getPolyR(t.trackNombre);r.setOptions({strokeColor:t.getPolyR(t.trackNombre).strokeColor,strokeOpacity:1,strokeWeight:a,icons:[e]})},t.renombrarR=function(a){0==t.isTrack&&(t.rutas[t.rutaNombre].nombre=a)},t.renombrarW=function(a){t.waypoints[t.wptNombre].nombre=a},t.changeMarkerPosition=function(a,o){var e=t.wptNombre,r=new google.maps.ElevationService,n=new google.maps.LatLng(a,o);isNaN(n.lat())||isNaN(n.lng())||(t.waypoints[e].longitud=parseFloat(o).toFixed(6),t.waypoints[e].latitud=parseFloat(a).toFixed(6),t.markers[e].setPosition(n),r.getElevationForLocations({locations:[n]},function(a,o){o===google.maps.ElevationStatus.OK&&a[0]&&(t.waypoints[e].elevacion=a[0].elevation.toFixed(2))}),t.markers[e].title="Latitud: "+parseFloat(a).toFixed(6)+"\nLongitud: "+parseFloat(o).toFixed(6))},t.invertirRuta2=function(){var a,o;t.rutas[t.rutaActiva].direccionOriginal?(a={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.getPoly().strokeColor,strokeOpacity:.7,strokeWeight:t.getPoly().strokeWeight,scale:2.7},o={icon:a,offset:"50%",repeat:"80px"},t.rutas[t.rutaActiva].direccionOriginal=!1):(a={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.getPoly().strokeColor,strokeOpacity:.7,strokeWeight:t.getPoly().strokeWeight,scale:2.7},o={icon:a,offset:"50%",repeat:"80px"},t.rutas[t.rutaActiva].direccionOriginal=!0);var e=new Array,r=new Array,n=t.getPoly();n.setOptions({strokeColor:t.getPoly().strokeColor,strokeOpacity:1,strokeWeight:t.getPoly().strokeWeight,icons:[o]});for(var i=t.rutas[t.rutaActiva].puntos.length-1;i>=0;i--)e.push(t.rutas[t.rutaActiva].puntos[i]),r.push(t.wpRta[t.rutaActiva][i]);for(var i=t.rutas[t.rutaActiva].puntos.length-1;i>=0;i--)t.rutas[t.rutaActiva].puntos.splice(i,1),t.puntosTrackActivo.splice(i,1),t.wpRta[t.rutaActiva][i].setMap(null),t.wpRta[t.rutaActiva].splice(i,1);for(var i in e){if(0==i)e[i].desnivel=0,e[i].distancia=0,e[i].numero=0,r[i].setIcon(t.myIconRIni);else{var c=new google.maps.LatLng(e[i].latitud,e[i].longitud),s=new google.maps.LatLng(e[i-1].latitud,e[i-1].longitud);e[i].distancia=google.maps.geometry.spherical.computeDistanceBetween(s,c).toFixed(2),e[i].numero=i,e[i].desnivel=(e[i].elevacion-e[i-1].elevacion).toFixed(2)}i==e.length-1&&r[i].setIcon(t.myIconRFin),t.wpRta[t.rutaActiva].push(r[i]),t.wpRta[t.rutaActiva][i].setMap(t.mapa),t.rutas[t.rutaActiva].puntos.push(e[i]),t.getPoly().getPath().setAt(i,new google.maps.LatLng(t.wpRta[t.rutaActiva][i].position.lat(),t.wpRta[t.rutaActiva][i].position.lng()))}t.puntosTrackActivo=t.rutas[t.rutaActiva].puntos,t.rutas[t.rutaActiva].fecha=new Date,t.rutas[t.rutaActiva].distancia=0,t.rutas[t.rutaActiva].desnivelP=0,t.rutas[t.rutaActiva].desnivelN=0,t.rutas[t.rutaActiva].elevMax=0,t.rutas[t.rutaActiva].elevMin=9999999;for(var i in t.rutas[t.rutaActiva].puntos)t.calcularDatosTrack(1,t.rutas[t.rutaActiva].puntos[i],t.rutaActiva);t.actualizarPuntosR()},t.invertirTrack2=function(){var a,o;t.tracks[t.trackActivo].direccionOriginal?(a={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.getPoly().strokeColor,strokeOpacity:.7,strokeWeight:t.getPoly().strokeWeight,scale:2.7},o={icon:a,offset:"50%",repeat:"80px"},t.tracks[t.trackActivo].direccionOriginal=!1):(a={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.getPoly().strokeColor,strokeOpacity:.7,strokeWeight:t.getPoly().strokeWeight,scale:2.7},o={icon:a,offset:"50%",repeat:"80px"},t.tracks[t.trackActivo].direccionOriginal=!0);var e=new Array,r=new Array,n=t.getPoly();n.setOptions({strokeColor:t.getPoly().strokeColor,strokeOpacity:1,strokeWeight:t.getPoly().strokeWeight,icons:[o]});for(var i=t.tracks[t.trackActivo].puntos.length-1;i>=0;i--)e.push(t.tracks[t.trackActivo].puntos[i]),r.push(t.markersT[t.trackActivo][i]);for(var i=t.tracks[t.trackActivo].puntos.length-1;i>=0;i--)t.tracks[t.trackActivo].puntos.splice(i,1),t.puntosTrackActivo.splice(i,1),t.markersT[t.trackActivo][i].setMap(null),t.markersT[t.trackActivo].splice(i,1);for(var i in e){if(0==i)e[i].desnivel=0,e[i].distancia=0,e[i].numero=0,r[i].setIcon(t.myIconRIni);else{var c=new google.maps.LatLng(e[i].latitud,e[i].longitud),s=new google.maps.LatLng(e[i-1].latitud,e[i-1].longitud);e[i].distancia=google.maps.geometry.spherical.computeDistanceBetween(s,c).toFixed(2),e[i].numero=i,e[i].desnivel=(e[i].elevacion-e[i-1].elevacion).toFixed(2)}i==e.length-1&&r[i].setIcon(t.myIconRFin),t.markersT[t.trackActivo].push(r[i]),t.markersT[t.trackActivo][i].setMap(t.mapa),t.tracks[t.trackActivo].puntos.push(e[i]),t.getPoly().getPath().setAt(i,new google.maps.LatLng(t.markersT[t.trackActivo][i].position.lat(),t.markersT[t.trackActivo][i].position.lng()))}t.puntosTrackActivo=t.tracks[t.trackActivo].puntos,t.tracks[t.trackActivo].fecha=new Date,t.tracks[t.trackActivo].distancia=0,t.tracks[t.trackActivo].desnivelP=0,t.tracks[t.trackActivo].desnivelN=0,t.tracks[t.trackActivo].elevMax=0,t.tracks[t.trackActivo].elevMin=9999999,t.tracks[t.trackActivo].duracionIda=0,t.tracks[t.trackActivo].duracionVuelta=0;for(var i in t.tracks[t.trackActivo].puntos)t.calcularDatosTrack(0,t.tracks[t.trackActivo].puntos[i],t.trackActivo),t.tracks[t.trackActivo].duracionIda=parseFloat(t.calcularDuracion(!0,t.trackActivo)).toFixed(2),
t.tracks[t.trackActivo].duracionVuelta=parseFloat(t.calcularDuracion(!1,t.trackActivo)).toFixed(2),t.calcularFecha(t.trackActivo,t.calcularDuracionPuntos(t.tracks[t.trackActivo].puntos[i])),t.tracks[t.trackActivo].puntos[i].fecha=t.tracks[t.trackActivo].fecha.getDate()+"/"+t.tracks[t.trackActivo].fecha.getMonth()+"/"+t.tracks[t.trackActivo].fecha.getFullYear(),t.tracks[t.trackActivo].puntos[i].hora=t.tracks[t.trackActivo].fecha.getHours()+":"+t.ordenarMinutos();t.actualizarPuntosT()},t.borrarTrack=function(){if(void 0!==t.polyLineas[t.trackActivo]&&(t.getPoly().setMap(null),t.polyLineas.splice(t.trackActivo,1)),void 0!==t.markersT[t.trackActivo])for(var a in t.markersT[t.trackActivo])t.markersT[t.trackActivo][a].setMap(null);t.tienePoly[t.trackActivo]=!1,t.tienePoly.splice(t.trackActivo,1),t.markersT[t.trackActivo]=void 0,t.markersT.splice(t.trackActivo,1);for(var a=t.tracks[t.trackActivo].puntos.length-1;a>=0;a--)t.tracks[t.trackActivo].puntos.splice(a,1),t.puntosTrackActivo.splice(a,1);t.tracks.splice(t.trackActivo,1),t.tracks.length<1&&t.rutas.length<1&&t.waypoints.length<1&&(t.hayEntidadesCreadas=!1)},t.borrarRuta=function(){t.polyLineasR[t.rutaActiva].setMap(null),t.polyLineasR.splice(t.rutaActiva,1);for(var a in t.wpRta[t.rutaActiva])t.wpRta[t.rutaActiva][a].setMap(null);t.tienePolyR[t.rutaActiva]=!1,t.tienePolyR.splice(t.rutaActiva,1),t.wpRta[t.rutaActiva]=void 0,t.wpRta.splice(t.rutaActiva,1);for(var o=t.rutas[t.rutaActiva].puntos.length-1;o>=0;o--)t.rutas[t.rutaActiva].puntos.splice(o,1),t.puntosTrackActivo.splice(o,1);t.rutas.splice(t.rutaActiva,1),t.tracks.length<1&&t.rutas.length<1&&t.waypoints.length<1&&(t.hayEntidadesCreadas=!1)},t.borrarWp=function(){t.markers[t.wpActivo].setMap(null),t.markers.splice(t.wpActivo,1),t.waypoints.splice(t.wpActivo,1),t.tracks.length<1&&t.rutas.length<1&&t.waypoints.length<1&&(t.hayEntidadesCreadas=!1)},t.cambiarTiempos=function(a,o,e){t.velocidad=a,t.tracks[t.trackActivo].duracionIda=t.calcularDuracion(!0,e).toFixed(2),t.tracks[t.trackActivo].duracionVuelta=t.calcularDuracion(!1,e).toFixed(2),t.tracks[t.trackActivo].fecha=o;for(var r in t.puntosTrackActivo)t.calcularDuracionPuntos(t.puntosTrackActivo[r]),t.calcularFecha(t.trackActivo,t.calcularDuracionPuntos(t.puntosTrackActivo[r])),t.puntosTrackActivo[r].fecha=t.tracks[t.trackActivo].fecha.getDate()+"/"+t.tracks[t.trackActivo].fecha.getMonth()+"/"+t.tracks[t.trackActivo].fecha.getFullYear(),t.puntosTrackActivo[r].hora=t.tracks[t.trackActivo].fecha.getHours()+":"+t.ordenarMinutos(),t.puntosTrackActivo[r].velocidad=60/t.velocidad},t.calcularDuracion=function(a,o){if(a)var e=(parseFloat(t.tracks[o].desnivelP)/400).toFixed(2),r=Math.abs(parseFloat(t.tracks[o].desnivelN)/600).toFixed(2);else var e=Math.abs(parseFloat(t.tracks[o].desnivelN)/400).toFixed(2),r=(parseFloat(t.tracks[o].desnivelP)/600).toFixed(2);var n=(parseFloat(t.tracks[o].distancia)/parseFloat(t.velocidad)).toFixed(2),i=parseFloat(r)+parseFloat(e);if(n>=i){var c=parseFloat(.5*i).toFixed(2);"NaN"==c&&(c=0);var s=parseFloat(n)+parseFloat(c),l=10*s,u=60*s+l,p=u/60;return p}var c=parseFloat(.5*n).toFixed(2),s=parseFloat(i)+parseFloat(c),l=10*s,u=60*s+l,p=u/60;return p},t.calcularDuracionPuntos=function(a){var o=parseFloat(a.desnivel)/400,e=Math.abs(parseFloat(a.desnivel)/600);a.desnivel>0?e=0:o=0;var r=a.distancia/1e3,n=parseFloat(r)/parseFloat(t.velocidad),i=parseFloat(e)+parseFloat(o);if(n>=i){var c=parseFloat(.5*i);"NaN"==c&&(c=0);var s=parseFloat(n)+parseFloat(c),l=10*s,u=60*s+l,p=u/60;return p}var c=parseFloat(.5*n),s=parseFloat(i)+parseFloat(c),l=10*s,u=60*s+l,p=u/60;return p},t.calcularFecha=function(a,o){t.segundosAnadir=t.segundosAnadir+parseFloat(o)*parseFloat(3600),t.segundosAnadir>=60&&(t.tracks[a].fecha.setSeconds(t.segundosAnadir),t.segundosAnadir=0)},t.calcularFechaR=function(a){var o=a/1e3,e=t.distancia*o,r=parseInt(60*e);t.rutas[t.rutaActiva].fecha.setSeconds(r)},t.ordenarMinutos=function(){var a;return a=t.tracks[t.trackActivo].fecha.getMinutes()<10?"0"+t.tracks[t.trackActivo].fecha.getMinutes():t.tracks[t.trackActivo].fecha.getMinutes()},t.ordenarMinutosR=function(){var a;return a=t.rutas[t.rutaActiva].fecha.getMinutes()<10?"0"+t.rutas[t.rutaActiva].fecha.getMinutes():t.rutas[t.rutaActiva].fecha.getMinutes()},t.calcularDatosTrack=function(a,o,e){0==a?(t.tracks[e].distancia=(parseFloat(t.tracks[e].distancia)+parseFloat(o.distancia)/1e3).toFixed(2),parseFloat(o.desnivel)>=0?t.tracks[e].desnivelP=(parseFloat(o.desnivel)+parseFloat(t.tracks[e].desnivelP)).toFixed(2):t.tracks[e].desnivelN=(parseFloat(o.desnivel)+parseFloat(t.tracks[e].desnivelN)).toFixed(2),parseFloat(o.elevacion)>parseFloat(t.tracks[e].elevMax)&&(t.tracks[e].elevMax=parseFloat(o.elevacion).toFixed(2)),parseFloat(o.elevacion)<parseFloat(t.tracks[e].elevMin)&&(t.tracks[e].elevMin=parseFloat(o.elevacion).toFixed(2))):(t.rutas[e].distancia=(parseFloat(t.rutas[e].distancia)+parseFloat(o.distancia)/1e3).toFixed(2),parseFloat(o.desnivel)>=0?t.rutas[e].desnivelP=(parseFloat(o.desnivel)+parseFloat(t.rutas[e].desnivelP)).toFixed(2):t.rutas[e].desnivelN=(parseFloat(o.desnivel)+parseFloat(t.rutas[e].desnivelN)).toFixed(2),parseFloat(o.elevacion)>parseFloat(t.rutas[e].elevMax)&&(t.rutas[e].elevMax=parseFloat(o.elevacion).toFixed(2)),parseFloat(o.elevacion)<parseFloat(t.rutas[e].elevMin)&&(t.rutas[e].elevMin=parseFloat(o.elevacion).toFixed(2)))},t.tienePolyF=function(){return t.isTrack?t.tienePoly[t.trackActivo]:t.tienePolyR[t.rutaActiva]},t.tienePolyFR=function(a){return t.isTrack?t.tienePoly[a]:t.tienePolyR[a]},t.colorPoly=function(){return t.isTrack?t.colorAleatorio():t.colorAleatorio()},t.addPolyR=function(a,o){t.isTrack?(t.polyLineas[o]=a,t.tienePoly[o]=!0):(t.polyLineasR[o]=a,t.tienePolyR[o]=!0)},t.addPoly=function(a){t.isTrack?(t.polyLineas[t.trackActivo]=a,t.tienePoly[t.trackActivo]=!0):(t.polyLineasR[t.rutaActiva]=a,t.tienePolyR[t.rutaActiva]=!0)},t.getPolyR=function(a){return t.isTrack?t.polyLineas[a]:t.polyLineasR[a]},t.getPoly=function(){return t.isTrack?t.polyLineas[t.trackActivo]:t.polyLineasR[t.rutaActiva]},t.vermarkers=function(){if(t.mapa.getZoom()>=17)for(var a in t.markersT[t.trackActivo])t.markersT[t.trackActivo][a].setVisible(t.ver)},t.actualizarMarkerActivo=function(){if(t.ver&&t.mapa.getZoom()>=17&&0==t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-2].getVisible())for(var a in t.markersT[t.trackActivo])t.markersT[t.trackActivo][a].setVisible(!0);if(t.ver&&t.mapa.getZoom()<17&&1==t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-2].getVisible())for(var a in t.markersT[t.trackActivo])0!=a&&a!=t.markersT[t.trackActivo].length-1&&t.markersT[t.trackActivo][a].setVisible(!1)},t.actualizarMarkerActivoR=function(){if(0==t.wpRta[t.rutaActiva][t.wpRta[t.rutaActiva].length-2].getVisible())for(var a in t.wpRta[t.rutaActiva])t.wpRta[t.rutaActiva][a].setVisible(!0);if(1==t.wpRta[t.rutaActiva][t.wpRta[t.rutaActiva].length-2].getVisible())for(var a in t.wpRta[t.rutaActiva])0!=a&&a!=t.wpRta[t.rutaActiva].length-1&&t.wpRta[t.rutaActiva][a].setVisible(!1)},t.actualizarMarkersR2=function(){var a=-1;for(var o in t.rutas)void 0!=t.wpRta[o]&&t.wpRta[o].length>1&&t.wpRta[o][1].getVisible()&&(a=o);for(var o in t.wpRta[t.rutaActiva])0==t.isTrack&&t.wpRta[t.rutaActiva][o].setVisible(!0);if(a!=-1)for(var o in t.wpRta[a])0!=o&&o!=t.wpRta[a].length-1&&t.wpRta[a][o].setVisible(!1)},t.actualizarMarkers2=function(){var a=-1;for(var o in t.tracks)void 0!=t.markersT[o]&&t.markersT[o].length>1&&t.markersT[o][1].getVisible()&&(a=o);for(var o in t.markersT[t.trackActivo])t.mapa.getZoom()>=17&&1==t.isTrack&&t.markersT[t.trackActivo][o].setVisible(!0);if(a!=-1)for(var o in t.markersT[a])0!=o&&o!=t.markersT[a].length-1&&t.markersT[a][o].setVisible(!1)},t.actualizarPuntosT=function(){t.tracks.length>0&&(t.puntosTrackActivo=t.tracks[t.trackActivo].puntos,t.actualizarPuntos())},t.actualizarPuntosR=function(){t.rutas.length>0&&(t.puntosTrackActivo=t.rutas[t.rutaActiva].puntos,t.actualizarPuntos())},t.actualizarDistancias=function(){t.distancias.length=0;for(var a in t.puntosTrackActivo)t.distancias.push(t.puntosTrackActivo[a].distancia);return t.distancias},t.actualizarElevaciones=function(){t.elevaciones.length=0;for(var a in t.puntosTrackActivo)t.elevaciones.push(t.puntosTrackActivo[a].elevacion);return t.elevaciones},t.cargarElevaciones=function(a){var o=new google.maps.ElevationService;t.puntos=new Array;for(var e in t.tracks[t.trackActivo].puntos){var r=new google.maps.LatLng(t.tracks[t.trackActivo].puntos[e].latitud,t.tracks[t.trackActivo].puntos[e].longitud);o.getElevationForLocations({locations:[r]},function(a,o){o===google.maps.ElevationStatus.OK&&a[0]&&(console.log("item"),console.log(e),console.log("Array de elevaciones"),console.log(t.puntos),t.puntos.push(a[0].elevation.toFixed(2)))})}setTimeout(function(){for(var a in t.puntos)t.tracks[t.trackActivo].puntos[a].elevacion=t.puntos[a],0==a?t.tracks[t.trackActivo].puntos[a].desnivel=0:t.tracks[t.trackActivo].puntos[a].desnivel=(t.tracks[t.trackActivo].puntos[a].elevacion-t.tracks[t.trackActivo].puntos[a-1].elevacion).toFixed(2),t.puntosTrackActivo[a]=t.tracks[t.trackActivo].puntos[a],console.log("Puntos del track normal"),console.log(t.tracks[t.trackActivo].puntos),console.log("Puntos del track activo"),console.log(t.puntosTrackActivo)},2e3)},t.actualizarPuntos=function(){t.elevaciones2=t.actualizarElevaciones(),t.distancias2=t.actualizarDistancias(),t.calcularPuntosGrafico()},t.calcularPuntosGrafico=function(){var a=0;t.puntosGrafico.length=0;for(var o in t.distancias){a=parseFloat(a)+parseFloat(t.distancias[o]);var e={x:parseFloat(a/1e3).toFixed(2),y:t.elevaciones[o]};t.puntosGrafico.push(e)}},t.getPuntosGrafico=function(){return t.puntosGrafico},t.crear=function(a){switch(a){case 0:t.hayEntidadesCreadas=!0,t.entidad={nombre:"Nuevo-Track"+t.tracks.length,distancia:0,desnivelP:0,desnivelN:0,elevMax:0,elevMin:9999999,puntos:[],numero:t.tracks.length,fecha:new Date,duracionIda:0,duracionVuelta:0,direccionOriginal:!0},t.tracks.push(t.entidad),t.tienePoly.push(!1),t.isTrack=!0,t.isWaypoint=!1;break;case 1:t.hayEntidadesCreadas=!0,t.entidad={nombre:"Nueva-Ruta"+t.rutas.length,distancia:0,desnivelP:0,desnivelN:0,elevMax:0,elevMin:9999999,puntos:[],numero:t.rutas.length,fecha:new Date,duracion:0,direccionOriginal:!0},t.rutas.push(t.entidad),t.tienePolyR.push(!1),t.isTrack=!1,t.isWaypoint=!1;break;case 2:t.entidad={nombre:"Nuevo-Waypoint"+t.waypoints.length,latitud:t.latitud,longitud:t.longitud,elevacion:t.elevacion,numero:t.waypoints.length,descripcion:"Añade una descripción"},t.waypoints.push(t.entidad),t.isWaypoint=!0,t.isTrack=!1,setTimeout(function(){for(var a in t.waypoints)a!=t.waypoints.length-1?$("#inw"+a).attr("checked",!1):($("#inw"+a).prop("checked",!0),$("#inw"+a).click())},10)}return t.entidad},t.calcularDesnivelR=function(){return 1==t.modoRecorte1?t.rutas[t.rutas.length-2].puntos.length>0?(t.elevacion-t.rutas[t.rutas.length-2].puntos[t.rutas[t.rutas.length-2].puntos.length-1].elevacion).toFixed(2):0:1==t.modoRecorte2?t.rutas[t.rutas.length-1].puntos.length>0?(t.elevacion-t.rutas[t.rutas.length-1].puntos[t.rutas[t.rutas.length-1].puntos.length-1].elevacion).toFixed(2):0:t.puntosTrackActivo.length>0?(t.elevacion-t.puntosTrackActivo[t.puntosTrackActivo.length-1].elevacion).toFixed(2):0},t.calcularDesnivel=function(){return 1==t.modoRecorte1?t.tracks[t.tracks.length-2].puntos.length>0?(t.elevacion-t.tracks[t.tracks.length-2].puntos[t.tracks[t.tracks.length-2].puntos.length-1].elevacion).toFixed(2):0:1==t.modoRecorte2?t.tracks[t.tracks.length-1].puntos.length>0?(t.elevacion-t.tracks[t.tracks.length-1].puntos[t.tracks[t.tracks.length-1].puntos.length-1].elevacion).toFixed(2):0:t.puntosTrackActivo.length>0?(t.elevacion-t.puntosTrackActivo[t.puntosTrackActivo.length-1].elevacion).toFixed(2):0},t.anadirPunto=function(a,o,e,r){switch(a){case 0:null!=t.trackElegidoFinalMarker&&t.trackElegidoFinalMarker.setMap(null),null!=t.trackElegidoInicialMarker&&t.trackElegidoInicialMarker.setMap(null),t.punto={numero:0,latitud:e,longitud:r,elevacion:t.elevacion,fecha:t.tracks[o].fecha.getDate()+"/"+t.tracks[o].fecha.getMonth()+"/"+t.tracks[o].fecha.getFullYear(),hora:t.tracks[o].fecha.getHours()+":"+t.ordenarMinutos(),desnivel:t.calcularDesnivel(),distancia:t.distancia,velocidad:15},t.tracks.length>0&&(t.punto.numero=t.tracks[o].puntos.length,t.tracks[o].puntos.push(t.punto),t.calcularDatosTrack(0,t.punto,o),t.tracks[o].duracionIda=parseFloat(t.calcularDuracion(!0,o)).toFixed(2),t.tracks[o].duracionVuelta=parseFloat(t.calcularDuracion(!1,o)).toFixed(2),t.calcularFecha(o,t.calcularDuracionPuntos(t.punto)),t.tracks[o].puntos[t.tracks[o].puntos.length-1].fecha=t.tracks[o].fecha.getDate()+"/"+t.tracks[o].fecha.getMonth()+"/"+t.tracks[o].fecha.getFullYear(),t.tracks[o].puntos[t.tracks[o].puntos.length-1].hora=t.tracks[o].fecha.getHours()+":"+t.ordenarMinutos());break;case 1:t.calcularFechaR(15),t.punto={numero:0,latitud:e,longitud:r,elevacion:t.elevacion,fecha:t.rutas[o].fecha.getDate()+"/"+t.rutas[o].fecha.getMonth()+"/"+t.rutas[o].fecha.getFullYear(),hora:t.rutas[o].fecha.getHours()+":"+t.ordenarMinutosR(),desnivel:t.calcularDesnivelR(),distancia:t.distancia,velocidad:4},t.rutas.length>0&&(t.punto.numero=t.rutas[o].puntos.length,t.rutas[o].puntos.push(t.punto),t.calcularDatosTrack(1,t.punto,o))}return t.punto}}angular.module("GPS").service("EntidadesService",t)})();