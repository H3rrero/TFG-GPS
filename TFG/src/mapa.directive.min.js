(function(){"use strict";function t(t,o,a){var e=function(e,i,n,l){function r(){function e(t,o,a){var e=g.getProjection(),i=Math.pow(2,o),n=new google.maps.Point(256*t.x/i,256*(t.y+1)/i),l=new google.maps.Point(256*(t.x+1)/i,256*t.y/i),r=e.fromPointToLatLng(n),s=e.fromPointToLatLng(l),p=r.lat()+","+r.lng()+","+s.lat()+","+s.lng();return a+"&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:4326&WIDTH=250&HEIGHT=250&BBOX="+p}function n(t,o,a){var e=g.getProjection(),i=Math.pow(2,o),n=new google.maps.Point(256*t.x/i,256*(t.y+1)/i),l=new google.maps.Point(256*(t.x+1)/i,256*t.y/i),r=e.fromPointToLatLng(n),s=e.fromPointToLatLng(l),p=r.lng()+","+r.lat()+","+s.lng()+","+s.lat();return a+"&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:4326&WIDTH=250&HEIGHT=250&BBOX="+p+"&WIDTH=256&HEIGHT=256"}function l(t,o,a){var e=1<<o,i=t.x%e;return i<0&&(i=e+i),a+o+"/"+i+"/"+t.y+".png"}function r(t,o,a){var e=1<<o,i=t.x%e;return i<0&&(i=e+i),"http://a"+a+o+"/"+i+"/"+t.y+".png"}var p=[];p.push(google.maps.MapTypeId.ROADMAP),p.push(google.maps.MapTypeId.SATELLITE);var d={center:{lat:40.41,lng:-3.7},zoom:12,disableDefaultUI:!0,mapTypeControl:!0,scaleControl:!0,visibleGridLines:!0};for(var m in o.mapas)p.push(o.mapas[m].nombre);var u=function(t,a){return new google.maps.ImageMapType({getTileUrl:function(i,s){if(o.mapas[a].nombre==t)return"1.3.0"==o.mapas[a].versionWMS?e(i,s,o.mapas[a].url):"1.1.1"==o.mapas[a].versionWMS?n(i,s,o.mapas[a].url):"topo"==o.mapas[a].versionWMS?r(i,s,o.mapas[a].url):l(i,s,o.mapas[a].url)},isPng:!1,maxZoom:20,minZoom:1,name:o.mapas[a].nombre,tileSize:new google.maps.Size(256,256)})};g=new google.maps.Map(i[0],d),c=new google.maps.ElevationService;for(var m in o.mapas)g.mapTypes.set(o.mapas[m].nombre,u(o.mapas[m].nombre,m));g.setOptions({mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:p}});var k=document.getElementById("on/Off"),v=(document.getElementById("botones"),document.getElementById("prueba")),F=(document.getElementById("funciones"),document.getElementById("pac-input")),x=document.getElementById("datos"),L=document.getElementById("grafica"),h=document.getElementById("lista"),R=document.getElementById("type-selector");g.controls[google.maps.ControlPosition.TOP_RIGHT].push(F),g.controls[google.maps.ControlPosition.TOP_RIGHT].push(R),g.controls[google.maps.ControlPosition.RIGHT_TOP].push(k),g.controls[google.maps.ControlPosition.RIGHT_TOP].push(v),g.controls[google.maps.ControlPosition.TOP_LEFT].push(x),g.controls[google.maps.ControlPosition.TOP_CENTER].push(h),g.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(L);var T=new google.maps.places.Autocomplete(F);T.bindTo("bounds",g);var f=new google.maps.InfoWindow,w=new google.maps.Marker({map:g,anchorPoint:new google.maps.Point(0,-29)});T.addListener("place_changed",function(){f.close(),w.setVisible(!1);var t=T.getPlace();if(!t.geometry)return void window.alert("Autocomplete's returned place contains no geometry");t.geometry.viewport?g.fitBounds(t.geometry.viewport):(g.setCenter(t.geometry.location),g.setZoom(17)),w.setIcon({url:t.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),w.setPosition(t.geometry.location),w.setVisible(!0);var o="";t.address_components&&(o=[t.address_components[0]&&t.address_components[0].short_name||"",t.address_components[1]&&t.address_components[1].short_name||"",t.address_components[2]&&t.address_components[2].short_name||""].join(" ")),f.setContent("<div><strong>"+t.name+"</strong><br>"+o),f.open(g,w)}),g.addListener("click",s,c),g.addListener("zoom_changed",function(){void 0!=t.markersT[t.trackActivo]&&t.markersT[t.trackActivo].length>2&&1==t.isTrack&&(t.mapa.getZoom()>=17&&0==t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-2].getVisible()||t.mapa.getZoom()<17&&1==t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-2].getVisible())&&t.actualizarMarkerActivo(),t.cuadricula=!0}),google.maps.event.addListener(g,"idle",function(){a.draw("idle-0",1)}),g.addListener("mousemove",function(o){0==t.coords?($("#map").tooltip(),$("#map").attr("title","E: "+o.latLng.lat().toFixed(6)+"\nN: "+o.latLng.lng().toFixed(6)),$("#map").tooltip(),$("#map").mouseover()):$("#map").attr("title","")}),t.elevator=c,t.mapa=g,a.mapa=g}function s(o,a){if(1==t.modoImportWP){var i=new google.maps.LatLng(t.latitudPInv,t.longitudPInv);t.latitud=t.latitudPInv,t.longitud=t.longitudPInv,t.elevacion=t.elevacionP,l.crear(2);var n="Nuevo-Waypoint"+t.cont;t.cont=t.cont+1;var r=new google.maps.Marker({position:i,title:"Latitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),icon:"https://maps.google.com/mapfiles/ms/icons/green-dot.png",map:g});t.markers.push(r),r.addListener("click",function(){for(var o in t.waypoints)if(t.waypoints[o].latitud+t.waypoints[o].longitud==r.position.lat().toFixed(6)+r.position.lng().toFixed(6))var a='<div id="content"><label for="nombre" style="    color: #8a9499;">Nombre:</label><p id="nombre">'+t.waypoints[o].nombre+'</p><label for="descripcion" style="    color: #8a9499;">Descripción:</label><p id="descripcion">'+t.waypoints[o].descripcion+"</p></div>",e=new google.maps.InfoWindow({content:a});e.open(g,r)}),google.maps.event.addListener(r,"dragend",function(o){for(var a in t.waypoints)if("Latitud: "+t.waypoints[a].latitud+"\nLongitud: "+t.waypoints[a].longitud==r.title){var i=a;t.waypoints[a].longitud=o.latLng.lng().toFixed(6),t.waypoints[a].latitud=o.latLng.lat().toFixed(6),c.getElevationForLocations({locations:[o.latLng]},function(o,a){a===google.maps.ElevationStatus.OK&&o[0]&&(t.waypoints[i].elevacion=o[0].elevation.toFixed(2),e.$apply())})}r.position=o.latLng,r.title="Latitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),e.$apply()})}if(1==t.seleccion){var i=new google.maps.LatLng(t.latitudSelec,t.longitudSelec);null!=t.markerPunto&&t.markerPunto.setMap(null),r=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:i,icon:"https://maps.google.com/mapfiles/ms/icons/yellow-dot.png",zIndex:8}),t.markerPunto=r}if(1==t.modoInsertar&&null!=t.puntoElegido&&void 0!==o&&c.getElevationForLocations({locations:[o.latLng]},function(a,i){if(i===google.maps.ElevationStatus.OK&&a[0])if(t.puntoN={numero:0,latitud:0,longitud:0,elevacion:0,fecha:0,hora:0,desnivel:0,distancia:0,velocidad:4},t.puntoN.longitud=o.latLng.lng().toFixed(6),t.puntoN.latitud=o.latLng.lat().toFixed(6),t.puntoN.elevacion=a[0].elevation.toFixed(2),t.modoInsertar=!1,1==t.isTrack){var n=new google.maps.Marker({position:o.latLng,title:"Latitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),icon:t.myIcon,draggable:!0,map:g,zIndex:1});t.elevacionPtAnadido=a[0].elevation.toFixed(2),n.addListener("click",function(){for(var o in t.tracks){if(n.position.lat().toFixed(6)+n.position.lng().toFixed(6)==t.markersT[o][t.markersT[o].length-1].position.lat().toFixed(6)+t.markersT[o][t.markersT[o].length-1].position.lng().toFixed(6)){t.trackElegidoFinal=o,null!=t.trackElegidoFinalMarker&&t.trackElegidoFinalMarker.setMap(null);var a=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.markersT[o][t.markersT[o].length-1].position,icon:"img/primero.png",zIndex:9});t.trackElegidoFinalMarker=a}if(n.position.lat().toFixed(6)+n.position.lng().toFixed(6)==t.markersT[o][0].position.lat().toFixed(6)+t.markersT[o][0].position.lng().toFixed(6)){t.trackElegidoInicial=o,null!=t.trackElegidoInicialMarker&&t.trackElegidoInicialMarker.setMap(null);var e=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.markersT[o][0].position,icon:"img/segundo.png",zIndex:9});t.trackElegidoInicialMarker=e}}for(var o in t.markersT[t.trackActivo])n.position.lat().toFixed(6)+n.position.lng().toFixed(6)==t.markersT[t.trackActivo][o].position.lat().toFixed(6)+t.markersT[t.trackActivo][o].position.lng().toFixed(6)&&l.puntoSelec(o)}),n.addListener("dragend",function(o){for(var a in t.markersT[t.trackActivo])if(t.markersT[t.trackActivo][a].title==n.title){var i=a,l=o.latLng.lng().toFixed(6),r=o.latLng.lat().toFixed(6);c.getElevationForLocations({locations:[o.latLng]},function(o,a){if(a===google.maps.ElevationStatus.OK&&o[0]){var n=o[0].elevation.toFixed(2);t.moverPuntoTrack2(i,l,r,n),e.$apply()}})}e.$apply()}),t.anadirPuntoTrack2(n),setTimeout(function(){t.actualizarPuntosT(),e.$apply()},15)}else{var n=new google.maps.Marker({position:o.latLng,title:"",icon:t.myIconR,draggable:!0,map:g});n.addListener("click",function(){for(var o in t.rutas){if(n.position.lat().toFixed(6)+n.position.lng().toFixed(6)==t.wpRta[o][t.wpRta[o].length-1].position.lat().toFixed(6)+t.wpRta[o][t.wpRta[o].length-1].position.lng().toFixed(6)){t.rutaElegidoFinal=o,null!=t.rutaElegidoFinalMarker&&t.rutaElegidoFinalMarker.setMap(null);var a=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.wpRta[o][t.wpRta[o].length-1].position,icon:"img/primero.png",zIndex:9});t.rutaElegidoFinalMarker=a}if(n.position.lat().toFixed(6)+n.position.lng().toFixed(6)==t.wpRta[o][0].position.lat().toFixed(6)+t.wpRta[o][0].position.lng().toFixed(6)){t.rutaElegidoInicial=o,null!=t.rutaElegidoInicialMarker&&t.rutaElegidoInicialMarker.setMap(null);var e=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.wpRta[o][0].position,icon:"img/segundo.png",zIndex:9});t.rutaElegidoInicialMarker=e}}for(var o in t.wpRta[t.rutaActiva])n.position.lat().toFixed(6)+n.position.lng().toFixed(6)==t.wpRta[t.rutaActiva][o].position.lat().toFixed(6)+t.wpRta[t.rutaActiva][o].position.lng().toFixed(6)&&l.puntoSelecR(o)}),t.elevacionPtAnadido=a[0].elevation.toFixed(2),n.addListener("dragend",function(o){for(var a in t.wpRta[t.rutaActiva])if(t.wpRta[t.rutaActiva][a].title==n.title){var i=a,l=o.latLng.lng().toFixed(6),r=o.latLng.lat().toFixed(6);c.getElevationForLocations({locations:[o.latLng]},function(o,a){if(a===google.maps.ElevationStatus.OK&&o[0]){var n=o[0].elevation.toFixed(2);t.moverPuntoRuta2(i,l,r,n),e.$apply()}})}e.$apply()}),t.anadirPuntoRuta2(n),setTimeout(function(){l.actualizarPuntosR(),e.$apply()},15)}}),1==t.modoInvertir){var i=new google.maps.LatLng(t.latitudPInv,t.longitudPInv);if(1==t.isTrack?(t.elevacion=t.elevacionP,1==t.modoRecorte1||1==t.modoRecorte2?m(i):u(i),1==t.modoRecorte1?l.anadirPuntoTForMapR(t.tracks.length-2,i.lat().toFixed(6),i.lng().toFixed(6)):1==t.modoRecorte2?l.anadirPuntoTForMapR(t.tracks.length-1,i.lat().toFixed(6),i.lng().toFixed(6)):l.anadirPuntoTForMapI(i.lat().toFixed(6),i.lng().toFixed(6))):(t.elevacion=t.elevacionP,1==t.modoRecorte1||1==t.modoRecorte2?d(i):u(i),1==t.modoRecorte1?l.anadirPuntoRForMapR(t.rutas.length-2,i.lat().toFixed(6),i.lng().toFixed(6)):1==t.modoRecorte2?l.anadirPuntoRForMapR(t.rutas.length-1,i.lat().toFixed(6),i.lng().toFixed(6)):l.anadirPuntoRForMapI(i.lat().toFixed(6),i.lng().toFixed(6))),1==t.modoRecorte1){var s;if(s=t.isTrack?t.tracks.length-2:t.rutas.length-2,0==t.tienePolyFR(s)){var k={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.colorAleatorio(),strokeOpacity:.7,strokeWeight:2.9,scale:2.7},v={icon:k,offset:"50%",repeat:"80px"};p=new google.maps.Polyline({strokeColor:k.strokeColor,strokeOpacity:1,strokeWeight:3,icons:[v]}),p.setMap(g),t.addPolyR(p,s)}else p=t.getPolyR(s)}else if(1==t.modoRecorte2){var F;if(F=t.isTrack?t.tracks.length-1:t.rutas.length-1,0==t.tienePolyFR(F)){var k={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.colorAleatorio(),strokeOpacity:.7,strokeWeight:2.9,scale:2.7},v={icon:k,offset:"50%",repeat:"80px"};p=new google.maps.Polyline({strokeColor:k.strokeColor,strokeOpacity:1,strokeWeight:3,icons:[v]}),p.setMap(g),t.addPolyR(p,F)}else p=t.getPolyR(F)}else if(0==t.tienePolyF()){var k={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:t.colorPolyNF,strokeOpacity:.7,strokeWeight:2.9,scale:2.7},v={icon:k,offset:"50%",repeat:"80px"};p=new google.maps.Polyline({strokeColor:t.colorPolyNF,strokeOpacity:1,strokeWeight:3,icons:[v]}),p.setMap(g),t.addPoly(p)}else p=t.getPoly();var x=p.getPath();x.push(i);if(1==t.isTrack){var r=new google.maps.Marker({position:i,title:"Inicio del track\nLatitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),icon:t.myIconRIni,draggable:!0,map:g,zIndex:1});if(r.addListener("click",function(){for(var o in t.tracks){if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.markersT[o][t.markersT[o].length-1].position.lat().toFixed(6)+t.markersT[o][t.markersT[o].length-1].position.lng().toFixed(6)){t.trackElegidoFinal=o,null!=t.trackElegidoFinalMarker&&t.trackElegidoFinalMarker.setMap(null);var a=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.markersT[o][t.markersT[o].length-1].position,icon:"img/primero.png",zIndex:9});t.trackElegidoFinalMarker=a}if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.markersT[o][0].position.lat().toFixed(6)+t.markersT[o][0].position.lng().toFixed(6)){t.trackElegidoInicial=o,null!=t.trackElegidoInicialMarker&&t.trackElegidoInicialMarker.setMap(null);var e=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.markersT[o][0].position,icon:"img/segundo.png",zIndex:9});t.trackElegidoInicialMarker=e}}for(var o in t.markersT[t.trackActivo])r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.markersT[t.trackActivo][o].position.lat().toFixed(6)+t.markersT[t.trackActivo][o].position.lng().toFixed(6)&&l.puntoSelec(o)}),r.addListener("dragend",function(o){for(var a in t.markersT[t.trackActivo])if(t.markersT[t.trackActivo][a].title==r.title){var i=a,n=o.latLng.lng().toFixed(6),l=o.latLng.lat().toFixed(6);c.getElevationForLocations({locations:[o.latLng]},function(o,a){if(a===google.maps.ElevationStatus.OK&&o[0]){var r=o[0].elevation.toFixed(2);t.moverPuntoTrack2(i,n,l,r),e.$apply()}})}e.$apply()}),1==t.modoRecorte1)if(void 0===t.markersT[t.tracks.length-2]){var L=[];L.push(r),t.markersT[t.tracks.length-2]=L}else 1==t.markersT[t.tracks.length-2].length?(r.icon=t.myIconRFin,r.title="Latitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),t.markersT[t.tracks.length-2].push(r)):(r.icon=t.myIconRFin,r.title="Latitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),t.markersT[t.tracks.length-2][t.markersT[t.tracks.length-2].length-1].setIcon(t.myIcon),g.getZoom()<17?t.markersT[t.tracks.length-2][t.markersT[t.tracks.length-2].length-1].setVisible(!1):t.markersT[t.tracks.length-2][t.markersT[t.tracks.length-2].length-1].setVisible(!1),t.markersT[t.tracks.length-2].push(r));else if(1==t.modoRecorte2)if(void 0===t.markersT[t.tracks.length-1]){var L=[];L.push(r),t.markersT[t.tracks.length-1]=L}else 1==t.markersT[t.tracks.length-1].length?(r.icon=t.myIconRFin,r.title="Latitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),t.markersT[t.tracks.length-1].push(r)):(r.icon=t.myIconRFin,r.title="Latitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),t.markersT[t.tracks.length-1][t.markersT[t.tracks.length-1].length-1].setIcon(t.myIcon),g.getZoom()<17?t.markersT[t.tracks.length-1][t.markersT[t.tracks.length-1].length-1].setVisible(!1):t.markersT[t.tracks.length-1][t.markersT[t.tracks.length-1].length-1].setVisible(!1),t.markersT[t.tracks.length-1].push(r));else if(void 0===t.markersT[t.trackActivo]){var L=[];L.push(r),t.markersT[t.trackActivo]=L}else 1==t.markersT[t.trackActivo].length?(r.icon=t.myIconRFin,r.title="Latitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),t.markersT[t.trackActivo].push(r)):(r.icon=t.myIconRFin,r.title="Latitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-1].setIcon(t.myIcon),g.getZoom()<17?t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-1].setVisible(!1):t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-1].setVisible(!0),t.markersT[t.trackActivo].push(r))}else{var h,r=new google.maps.Marker({position:i,title:"",icon:t.myIconR,draggable:!0,map:g});if(h=1==t.modoRecorte1?t.rutas.length-2:1==t.modoRecorte2?t.rutas.length-1:t.rutaActiva,r.addListener("click",function(){for(var o in t.rutas){if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.wpRta[o][t.wpRta[o].length-1].position.lat().toFixed(6)+t.wpRta[o][t.wpRta[o].length-1].position.lng().toFixed(6)){t.rutaElegidoFinal=o,null!=t.rutaElegidoFinalMarker&&t.rutaElegidoFinalMarker.setMap(null);var a=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.wpRta[o][t.wpRta[o].length-1].position,icon:"img/primero.png",zIndex:9});t.rutaElegidoFinalMarker=a}if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.wpRta[o][0].position.lat().toFixed(6)+t.wpRta[o][0].position.lng().toFixed(6)){t.rutaElegidoInicial=o,null!=t.rutaElegidoInicialMarker&&t.rutaElegidoInicialMarker.setMap(null);var e=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.wpRta[o][0].position,icon:"img/segundo.png",zIndex:9});t.rutaElegidoInicialMarker=e}}for(var o in t.wpRta[h])r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.wpRta[h][o].position.lat().toFixed(6)+t.wpRta[h][o].position.lng().toFixed(6)&&l.puntoSelecR(o)}),r.addListener("dragend",function(o){for(var a in t.wpRta[h])if(t.wpRta[h][a].title==r.title){var i=a,n=o.latLng.lng().toFixed(6),l=o.latLng.lat().toFixed(6);c.getElevationForLocations({locations:[o.latLng]},function(o,a){if(a===google.maps.ElevationStatus.OK&&o[0]){var r=o[0].elevation.toFixed(2);t.moverPuntoRuta2(i,n,l,r),e.$apply()}})}e.$apply()}),void 0===t.wpRta[h]){var n="Waypoint Nº0";r.title="Nombre: "+n+"\nLatitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),r.icon=t.myIconRIni;var R=[];R.push(r),t.wpRta[h]=R}else if(1==t.wpRta[h].length){var n="Waypoint Nº"+t.wpRta[h].length;r.title="Nombre: "+n+"\nLatitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),r.icon=t.myIconRFin,t.wpRta[h].push(r)}else{t.wpRta[h][t.wpRta[h].length-1].setIcon(t.myIconR);var n="Waypoint Nº"+t.wpRta[t.rutaActiva].length;r.title="Nombre: "+n+"\nLatitud: "+i.lat().toFixed(6)+"\nLongitud: "+i.lng().toFixed(6),r.icon=t.myIconRFin,h==t.rutaActiva?t.wpRta[h][t.wpRta[h].length-1].setVisible(!0):t.wpRta[h][t.wpRta[h].length-1].setVisible(!1),t.wpRta[h].push(r)}}}if(1==t.modoEdicion&&0==t.modoInsertar&&0==t.modoImportWP&&0==t.modoInvertir&&0==t.seleccion&&1==t.hayEntidadesCreadas&&(1==t.isTrack||t.rutas.length>0)||1==t.isWaypoint&&0==t.modoImportWP&&1==t.modoEdicion){if(1==t.isTrack)c.getElevationForLocations({locations:[o.latLng]},function(a,e){e===google.maps.ElevationStatus.OK&&a[0]?(t.elevacion=a[0].elevation.toFixed(2),u(o.latLng),l.anadirPuntoTForMap(o.latLng.lat().toFixed(6),o.latLng.lng().toFixed(6))):l.anadirPuntoTForMap(o.latLng.lat().toFixed(6),o.latLng.lng().toFixed(6))});else if(1==t.isWaypoint)if(0==t.modoInsertarWp)t.latitud=o.latLng.lat().toFixed(6),t.longitud=o.latLng.lng().toFixed(6),c.getElevationForLocations({locations:[o.latLng]},function(o,a){a===google.maps.ElevationStatus.OK&&o[0]?(t.elevacion=o[0].elevation.toFixed(2),l.crear(2),e.$apply()):(l.crear(2),e.$apply())});else{var T=new google.maps.LatLng(t.latitud,t.longitud);c.getElevationForLocations({locations:[T]},function(o,a){a===google.maps.ElevationStatus.OK&&o[0]?(t.elevacion=o[0].elevation.toFixed(2),l.crear(2),e.$apply()):(l.crear(2),e.$apply())})}else c.getElevationForLocations({locations:[o.latLng]},function(a,e){e===google.maps.ElevationStatus.OK&&a[0]?(t.elevacion=a[0].elevation.toFixed(2),u(o.latLng),l.anadirPuntoRForMap(o.latLng.lat().toFixed(6),o.latLng.lng().toFixed(6))):l.anadirPuntoRForMap(o.latLng.lat().toFixed(6),o.latLng.lng().toFixed(6))});if(1==t.isWaypoint){var n="Nuevo-Waypoint"+t.cont;if(t.cont=t.cont+1,1==t.modoInsertarWp)var T=new google.maps.LatLng(t.latitud,t.longitud),r=new google.maps.Marker({position:T,title:"Latitud: "+parseFloat(t.latitud).toFixed(6)+"\nLongitud: "+parseFloat(t.longitud).toFixed(6),icon:"https://maps.google.com/mapfiles/ms/icons/green-dot.png",draggable:!0,map:g});else var r=new google.maps.Marker({position:o.latLng,title:"Latitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),icon:"https://maps.google.com/mapfiles/ms/icons/green-dot.png",draggable:!0,map:g});r.addListener("click",function(){for(var o in t.waypoints)if(t.waypoints[o].latitud+t.waypoints[o].longitud==r.position.lat().toFixed(6)+r.position.lng().toFixed(6))var a='<div id="content"><label for="nombre" style="    color: #8a9499;">Nombre:</label><p id="nombre">'+t.waypoints[o].nombre+'</p><label for="descripcion" style="    color: #8a9499;">Descripción:</label><p id="descripcion">'+t.waypoints[o].descripcion+"</p></div>",e=new google.maps.InfoWindow({content:a});e.open(g,r)}),google.maps.event.addListener(r,"dragend",function(o){for(var a in t.waypoints)if("Latitud: "+t.waypoints[a].latitud+"\nLongitud: "+t.waypoints[a].longitud==r.title){var i=a;t.waypoints[a].longitud=o.latLng.lng().toFixed(6),t.waypoints[a].latitud=o.latLng.lat().toFixed(6),c.getElevationForLocations({locations:[o.latLng]},function(o,a){a===google.maps.ElevationStatus.OK&&o[0]&&(t.waypoints[i].elevacion=o[0].elevation.toFixed(2),e.$apply())})}r.position=o.latLng,r.title="Latitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),e.$apply()}),t.markers.push(r)}else{if(0==t.tienePolyF()){var f=t.colorPoly();t.isTrack?$("#li"+t.trackActivo)[0].style.color=f:$("#lir"+t.rutaActiva)[0].style.color=f;var k={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,strokeColor:f,strokeOpacity:.7,strokeWeight:2.9,scale:2.7},v={icon:k,offset:"50%",repeat:"80px"};p=new google.maps.Polyline({strokeColor:f,strokeOpacity:1,strokeWeight:3,icons:[v]}),p.setMap(g),t.addPoly(p)}else p=t.getPoly();var x=p.getPath();x.push(o.latLng);if(1==t.isTrack){var r=new google.maps.Marker({position:o.latLng,title:"Inicio del track\nLatitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),icon:t.myIconRIni,draggable:!0,map:g,zIndex:1});if(r.addListener("click",function(){for(var o in t.tracks){if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.markersT[o][t.markersT[o].length-1].position.lat().toFixed(6)+t.markersT[o][t.markersT[o].length-1].position.lng().toFixed(6)){t.trackElegidoFinal=o,null!=t.trackElegidoFinalMarker&&t.trackElegidoFinalMarker.setMap(null);var a=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.markersT[o][t.markersT[o].length-1].position,icon:"img/primero.png",zIndex:9});t.trackElegidoFinalMarker=a}if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.markersT[o][0].position.lat().toFixed(6)+t.markersT[o][0].position.lng().toFixed(6)){t.trackElegidoInicial=o,null!=t.trackElegidoInicialMarker&&t.trackElegidoInicialMarker.setMap(null);var e=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.markersT[o][0].position,icon:"img/segundo.png",zIndex:9});t.trackElegidoInicialMarker=e}}for(var o in t.markersT[t.trackActivo])r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.markersT[t.trackActivo][o].position.lat().toFixed(6)+t.markersT[t.trackActivo][o].position.lng().toFixed(6)&&l.puntoSelec(o)}),r.addListener("dragend",function(o){for(var a in t.markersT[t.trackActivo])if(t.markersT[t.trackActivo][a].title==r.title){var i=a,n=o.latLng.lng().toFixed(6),l=o.latLng.lat().toFixed(6);c.getElevationForLocations({locations:[o.latLng]},function(o,a){if(a===google.maps.ElevationStatus.OK&&o[0]){var r=o[0].elevation.toFixed(2);t.moverPuntoTrack2(i,n,l,r),e.$apply()}})}e.$apply()}),void 0===t.markersT[t.trackActivo]){var L=[];L.push(r),t.markersT[t.trackActivo]=L}else 1==t.markersT[t.trackActivo].length?(r.icon=t.myIconRFin,r.title="Latitud:"+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),t.markersT[t.trackActivo].push(r)):(r.icon=t.myIconRFin,r.title="Latitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-1].setIcon(t.myIcon),g.getZoom()<17?t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-1].setVisible(!1):t.markersT[t.trackActivo][t.markersT[t.trackActivo].length-1].setVisible(!0),t.markersT[t.trackActivo].push(r))}else{var r=new google.maps.Marker({position:o.latLng,title:"",icon:t.myIconR,draggable:!0,map:g});if(r.addListener("click",function(){for(var o in t.rutas){if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.wpRta[o][t.wpRta[o].length-1].position.lat().toFixed(6)+t.wpRta[o][t.wpRta[o].length-1].position.lng().toFixed(6)){t.rutaElegidoFinal=o,null!=t.rutaElegidoFinalMarker&&t.rutaElegidoFinalMarker.setMap(null);var a=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.wpRta[o][t.wpRta[o].length-1].position,icon:"img/primero.png",zIndex:9});t.rutaElegidoFinalMarker=a}if(r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.wpRta[o][0].position.lat().toFixed(6)+t.wpRta[o][0].position.lng().toFixed(6)){t.rutaElegidoInicial=o,null!=t.rutaElegidoInicialMarker&&t.rutaElegidoInicialMarker.setMap(null);var e=new google.maps.Marker({map:g,draggable:!0,animation:google.maps.Animation.DROP,position:t.wpRta[o][0].position,icon:"img/segundo.png",zIndex:9});t.rutaElegidoInicialMarker=e}}for(var o in t.wpRta[t.rutaActiva])r.position.lat().toFixed(6)+r.position.lng().toFixed(6)==t.wpRta[t.rutaActiva][o].position.lat().toFixed(6)+t.wpRta[t.rutaActiva][o].position.lng().toFixed(6)&&l.puntoSelecR(o)}),r.addListener("dragend",function(o){for(var a in t.wpRta[t.rutaActiva])if(t.wpRta[t.rutaActiva][a].title==r.title){var i=a,n=o.latLng.lng().toFixed(6),l=o.latLng.lat().toFixed(6);c.getElevationForLocations({locations:[o.latLng]},function(o,a){if(a===google.maps.ElevationStatus.OK&&o[0]){var r=o[0].elevation.toFixed(2);t.moverPuntoRuta2(i,n,l,r),e.$apply()}})}e.$apply()}),void 0===t.wpRta[t.rutaActiva]){var n="Waypoint Nº0";r.title="Nombre: "+n+"\nLatitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),r.icon=t.myIconRIni;var R=[];R.push(r),t.wpRta[t.rutaActiva]=R}else if(1==t.wpRta[t.rutaActiva].length){var n="Waypoint Nº"+t.wpRta[t.rutaActiva].length;r.title="Nombre: "+n+"\nLatitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),r.icon=t.myIconRFin,t.wpRta[t.rutaActiva].push(r)}else{t.wpRta[t.rutaActiva][t.wpRta[t.rutaActiva].length-1].setIcon(t.myIconR);var n="Waypoint Nº"+t.wpRta[t.rutaActiva].length;r.title="Nombre: "+n+"\nLatitud: "+o.latLng.lat().toFixed(6)+"\nLongitud: "+o.latLng.lng().toFixed(6),r.icon=t.myIconRFin,t.wpRta[t.rutaActiva][t.wpRta[t.rutaActiva].length-1].setVisible(!0),t.wpRta[t.rutaActiva].push(r)}}}}}var g,p,c,d=function(o){if(1==t.modoRecorte1&&t.rutas[t.rutas.length-2].puntos.length>0){var a=new google.maps.LatLng(t.rutas[t.rutas.length-2].puntos[t.rutas[t.rutas.length-2].puntos.length-1].latitud,t.rutas[t.rutas.length-2].puntos[t.rutas[t.rutas.length-2].puntos.length-1].longitud);t.distancia=google.maps.geometry.spherical.computeDistanceBetween(o,a).toFixed(2)}else if(1==t.modoRecorte2&&t.rutas[t.rutas.length-1].puntos.length>0){var a=new google.maps.LatLng(t.rutas[t.rutas.length-1].puntos[t.rutas[t.rutas.length-1].puntos.length-1].latitud,t.rutas[t.rutas.length-1].puntos[t.rutas[t.rutas.length-1].puntos.length-1].longitud);t.distancia=google.maps.geometry.spherical.computeDistanceBetween(o,a).toFixed(2)}else t.distancia=0},m=function(o){if(1==t.modoRecorte1&&t.tracks[t.tracks.length-2].puntos.length>0){var a=new google.maps.LatLng(t.tracks[t.tracks.length-2].puntos[t.tracks[t.tracks.length-2].puntos.length-1].latitud,t.tracks[t.tracks.length-2].puntos[t.tracks[t.tracks.length-2].puntos.length-1].longitud);t.distancia=google.maps.geometry.spherical.computeDistanceBetween(o,a).toFixed(2)}else if(1==t.modoRecorte2&&t.tracks[t.tracks.length-1].puntos.length>0){var a=new google.maps.LatLng(t.tracks[t.tracks.length-1].puntos[t.tracks[t.tracks.length-1].puntos.length-1].latitud,t.tracks[t.tracks.length-1].puntos[t.tracks[t.tracks.length-1].puntos.length-1].longitud);t.distancia=google.maps.geometry.spherical.computeDistanceBetween(o,a).toFixed(2)}else t.distancia=0},u=function(o){if(t.puntosTrackActivo.length>0){var a=new google.maps.LatLng(t.puntosTrackActivo[t.puntosTrackActivo.length-1].latitud,t.puntosTrackActivo[t.puntosTrackActivo.length-1].longitud);t.distancia=google.maps.geometry.spherical.computeDistanceBetween(o,a).toFixed(2)}else t.distancia=0};r()};return{restrict:"E",template:'<div id="map"  title=""></div>',replace:!0,controller:"GPSController",link:e}}angular.module("GPS").directive("myMap",t),t.$inject=["EntidadesService","MapasService","GridService"]})();