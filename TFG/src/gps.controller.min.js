(function(){"use strict";function r(r,a,e,o,t,n,i){var s=this;s.trackActivo=0,s.rutaActiva=0,s.wpActivo=0,s.numTrack=0,s.numRuta=1,s.numWaypoint=2,a.penis=i.path(),s.tracks=a.tracks,s.rutas=a.rutas,s.waypoints=a.waypoints,s.puntosTrackActivo=a.puntosTrackActivo,s.modoCreacion=!1,a.modoCreacion=!1,s.mostrarMensaje=!1,s.mensajeError="",s.error=!1,s.puntoBorrado=!1,s.fichero,s.noError=!1,s.mensajeVerTabla="ver tabla",s.mensajeVerGrafica="ver gráfica",s.mensajeVerlista="ver lista",s.mensajeVerlistaR="ver lista",s.mensajeVerlistaW="ver lista",s.modoEdicion=a.modoEdicion,s.apiMaps=!0,s.conection=!1,s.coordV="ocultar coor",s.verMarker="ocultar puntos",s.tablaT=!1,s.escala="5km",s.capturaUrl="",s.pant=!0,s.whyCvsExport=!1,s.colorTrack="",s.nombre="",s.descrip="",r.color="#FF0000",s.grosor=0,s.lng="",s.lat="",s.lngNW,s.latNW,s.velocidad,s.fecha,s.cuenta=2,r.options={format:"hex"},n.onclick=function(r){r.target==document.getElementById("myModal")&&(document.getElementById("myModal").style.display="none")},r.eventApi={onChange:function(r,e,o){a.isTrack?(a.changedColor(e),$("#li"+a.trackNombre)[0].style.color=e):(a.changedColorR(e),$("#lir"+a.rutaNombre)[0].style.color=e)}},s.desSubrayar=function(r){$("#pt"+r)[0].style=""},s.subrayar=function(r){$("#pt"+r)[0].style="text-decoration: underline; cursor:pointer;"},s.desSubrayarr=function(r){$("#pr"+r)[0].style=""},s.subrayarr=function(r){$("#pr"+r)[0].style="text-decoration: underline; cursor:pointer;"},s.desSubrayarw=function(r){$("#pw"+r)[0].style=""},s.subrayarw=function(r){$("#pw"+r)[0].style="text-decoration: underline; cursor:pointer;"},s.openPopup=function(e){s.noError=!1,s.error=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track"):s.tracks[s.trackActivo].puntos.length<2?(s.error=!0,s.mensajeError="El track necesita tener al menos dos puntos para que exista una polilinea a la cual cambiar el color"):(a.trackNombre=e,r.myJSONObject={name:a.tracks[e].nombre},setTimeout(function(){t.open({template:'<div style="height: 210px;"><label for="nombre" class="prlabel">Nombre:</label><input type="text"   id="nombre" style="width: 100%;" placeholder="{{ngDialogData.name}}" ng-model="list1.nombre" ng-change="list1.renombrarT()"><label for="grosor" class="prlabel" style="margin-top: 1%;">Grosor:</label><input type="number"   id="grosor" style="width: 100%;" ng-model="list1.grosor" ng-change="list1.cambiarGrosor()"><label for="picker" class="prlabel" style="margin-top: 1%;">Color:</label><color-picker id="picker" ng-model="color" options="options"  event-api="eventApi" ></color-picker><button id="botoncerrardialog" type="button"  style="right: 0 !important;position: absolute; bottom: 4%;" ng-click="closeThisDialog(0)" class="bttn-unite bttn-xs bttn-primary stiloBtns">cerrar</button></div>',plain:!0,closeByEscape:!0,controllerAs:"list1",data:r.myJSONObject,controller:"GPSController"})},10))},s.openPopupR=function(e){s.noError=!1,s.error=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]||1==a.modoCreacion?(s.error=!0,s.mensajeError="Por favor selecciona una ruta"):s.rutas[s.rutaActiva].puntos.length<2?(s.error=!0,s.mensajeError="La ruta necesita tener al menos dos puntos para que exista una polilinea a la cual cambiar las propiedades"):(a.rutaNombre=e,r.myJSONObjectR={name:a.rutas[e].nombre},t.open({template:'<div style="height: 210px;"><label for="nombre" class="prlabel">Nombre:</label><input type="text"   id="nombre" style="width: 100%;" placeholder="{{ngDialogData.name}}" ng-model="list1.nombre" ng-change="list1.renombrarR()"><label for="grosor" class="prlabel" style="margin-top: 1%;">Grosor:</label><input type="number"   id="grosor" style="width: 100%;" ng-model="list1.grosor" ng-change="list1.cambiarGrosorR()"><label for="grosor" class="prlabel" style="margin-top: 1%;">Color:</label><color-picker id="picker" ng-model="color" options="options"  event-api="eventApi" ></color-picker><button id="botoncerrardialogR" type="button"  style="right: 0 !important;position: absolute; bottom: 4%;" ng-click="closeThisDialog(0)" class="bttn-unite bttn-xs bttn-primary stiloBtns">cerrar</button></div>',plain:!0,data:r.myJSONObjectR,controllerAs:"list1",controller:"GPSController"}))},s.openPopupW=function(e){s.noError=!1,s.error=!1,1==a.isTrack||void 0===a.waypoints[s.wpActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un waypoint"):a.waypoints.length<1?(s.error=!0,s.mensajeError="Necesitas tener waypoints creados para poder editarlos"):(a.wptNombre=e,r.myJSONObjectW={name:a.waypoints[e].nombre,desc:a.waypoints[e].descripcion,lat:a.waypoints[e].latitud,lng:a.waypoints[e].longitud},t.open({template:'<div style="height: 215px;"><label for="nombre" class="prlabel">Nombre:</label><input type="text"   id="nombre" style="width: 100%;" placeholder="{{ngDialogData.name}}" ng-model="list1.nombre" ng-change="list1.renombrarW()"><label for="descripcion" class="prlabel" style="margin-top: 1%;">Descripción:</label><input type="text"   id="descripcion" style="width: 100%;" placeholder="{{ngDialogData.desc}}"  ng-model="list1.descrip" ng-change="list1.descripcion()"><label for="coord" class="prlabel" style="margin-top: 1%;">Latitud y longitud:</label><input type="text"   id="coord" style="width: 45%;" placeholder="{{ngDialogData.lat}}"  ng-model="list1.lat" ng-change="list1.changeMarkerPosition()" ><input type="text"  style="margin-left: 2%;width: 45%;"  placeholder="{{ngDialogData.lng}}"   id="coordlng" ng-model="list1.lng" ng-change="list1.changeMarkerPosition()" ><button id="cerrarwp" type="button" ng-click="closeThisDialog(0)" style="float:right;margin-top: 5% !important"  class="bttn-unite bttn-xs bttn-primary stiloBtns">cerrar</button></div>',plain:!0,data:r.myJSONObjectW,controllerAs:"list1",controller:"GPSController"}))},s.openPopupNW=function(){t.open({template:'<label for="coord" class="prlabel">Latitud y longitud:</label><input type="text"   id="coord" style="width: 45%;"  placeholder="43.324228"   ng-model="list1.latNW" ><input type="text"  style="margin-left: 2%;width: 45%;"  placeholder="-5.629051"  id="coordlng" ng-model="list1.lngNW" ><button id="botonAnadirWp" type="button"  style="margin-top: 4% !important" ng-click="list1.anadirWaypoint()" class="bttn-unite bttn-xs bttn-success stiloBtns">crear</button>',plain:!0,showClose:!0,controllerAs:"list1",controller:"GPSController"})},s.anadirWaypoint=function(){s.activarListaR=!1,s.activarLista=!1,s.activarListaW=!0,s.mensajeVerlista="ver lista",s.mensajeVerlistaR="ver lista",s.mensajeVerlistaW="ocultar lista",a.isWaypoint=!0,a.isTrack=!1,s.modoCreacion=!0,a.modoCreacion=!0,null!=s.latNW&&null!=s.lngNW&&a.anadirWaypoint(s.latNW,s.lngNW),t.close()},s.cambiarGrosor=function(){null!=s.grosor&&s.grosor>0&&a.tracks.length>0&&a.grosor(s.grosor)},s.changeMarkerPosition=function(){null!=s.lat&&null!=s.lng&&a.waypoints.length>0&&a.changeMarkerPosition(s.lat,s.lng)},s.cambiarGrosorR=function(){null!=s.grosor&&s.grosor>0&&a.rutas.length>0&&a.grosorR(s.grosor)},s.startSpin=function(){o.spin("spinner-1")},s.stopSpin=function(){o.stop("spinner-1")},angular.element(document).ready(function(){setTimeout(s.actuTamano,500),setTimeout(function(){$(".gmnoprint.gm-style-mtc").eq(0).css("right",0)},500)}),s.actuTamano=function(){s.gr=$("#map"),s.gr.children().children().children()[14].style.right="220px",s.gr.children().children().children()[14].childNodes[1].childNodes[0].style.fontSize="16px",$(".gm-style-cc").css("z-index",10),s.gr.children().children().children()[14].childNodes[1].childNodes[0].style.fontWeight="bold"},s.closeModal=function(r){document.getElementById("myModal").style.display="none"},s.vermarkers=function(){a.ver?(a.ver=!1,s.verMarker="ver puntos",a.vermarkers()):(a.ver=!0,s.verMarker="ocultar puntos",a.vermarkers())},s.capPant=function(a){if(s.pant){s.capturaUrl="",s.startSpin();var e=$("div.tile");if(s.isChrome||s.isFirefox)for(var o in e)o<e.length&&(e[o].style.borderWidth="2px");html2canvas($(".gm-style")[0].childNodes[0],{useCORS:!0,onrendered:function(e){if((s.isFirefox||s.isChrome)&&(s.pant=!1,s.capturaUrl=e.toDataURL("image/jpg"),s.pant=!1,r.$apply(),s.stopSpin(),a?$("#downPt").click():$("#downPtR").click()),s.esIE||s.isEdge){s.capturaUrl=e.toDataURL("image/webp");for(var o=atob(s.capturaUrl.substring("data:image/png;base64,".length)),t=new Uint8Array(o.length),n=0,i=o.length;n<i;++n)t[n]=o.charCodeAt(n);var l=new Blob([t.buffer],{type:"image/png"});window.navigator.msSaveBlob(l,"prueba.png"),s.stopSpin()}s.isSafari&&(s.capturaUrl=e.toDataURL("image/png"),$("#btn-downloadTS").attr("href",s.capturaUrl),s.stopSpin())}});for(var o in e)o<e.length&&(e[o].style.borderWidth="1px")}else s.pant=!0},s.modoEdicionF=function(){s.noError=!1,s.error=!1,1==s.modoEdicion?(s.error=!0,s.modoEdicion=!1,a.modoEdicion=!1,s.mensajeError="Has desativado el modo edición"):(s.noError=!0,s.mensajeError="Has activado el modo edición",s.modoEdicion=!0,a.modoEdicion=!0)},s.activarImportWp=function(){s.error=!1,void 0==a.xmlImportado?(s.error=!0,s.mensajeError="Antes de importar selecciona un archivo con el boton seleccione fichero "):a.importXMLWp()},s.activarImportRuta=function(){s.error=!1,void 0==a.xmlImportado?(s.error=!0,s.mensajeError="Antes de importar selecciona un archivo con el boton seleccione fichero "):(s.crear(1),a.importXML())},s.activarImport=function(){s.error=!1,void 0==a.xmlImportado?(s.error=!0,s.mensajeError="Antes de importar selecciona un archivo con el boton seleccione fichero "):(s.crear(0),a.importXML())},s.unirRutas=function(){if(s.startSpin(),s.noError=!1,s.error=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]||1==a.modoCreacion)s.error=!0,s.mensajeError="Por favor muestra la lista de rutas(ver lista) para activar el modo ruta y poder acceder a sus funcionalidades";else if(a.rutas.length<2)s.error=!0,s.mensajeError="Se necesitan al menos dos rutas para poder realizar la unión";else if(a.rutaElegidoInicial==-1||a.rutaElegidoFinal==-1)s.error=!0,s.mensajeError="Debes seleccionar el punto final de la primera ruta de la uniónn y el punto inicial de la segunda ruta de la unión y despues darle a unir";else{var e=a.rutaElegidoInicial,o=a.rutaElegidoFinal;null==e||void 0==a.rutas[e]?(s.error=!0,s.mensajeError="La ruta elegida no existe"):a.rutas[o].puntos.length<2||a.rutas[e].puntos.length<2?(s.error=!0,s.mensajeError="Alguna de las dos rutas no dispone de al menos dos puntos creados"):e==o?(s.error=!0,s.mensajeError="Elige otra ruta, no se puede unir una ruta con ella misma"):(s.crear(1),setTimeout(function(){null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.unirRuta(e,o),r.$apply(),s.stopSpin()},100))}1==s.error&&s.stopSpin(),a.rutaElegidoFinal=-1,a.rutaElegidoInicial=-1,null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null)},s.unirTracks=function(){if(s.startSpin(),s.noError=!1,s.error=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo])s.error=!0,s.mensajeError="Por favor muestra la lista de tracks(ver lista) para activar el modo track y poder acceder a sus funcionalidades";else if(a.tracks.length<2)s.error=!0,s.mensajeError="Se necesitan al menos dos tracks para poder realizar la unión";else if(a.trackElegidoInicial==-1||a.trackElegidoFinal==-1)s.error=!0,s.mensajeError="Debes seleccionar el punto final del primer track de la uniónn y el punto inicial del segundo track de la unión y despues darle a unir";else{var e=a.trackElegidoInicial,o=a.trackElegidoFinal;null==e||void 0==a.tracks[e]?(s.error=!0,s.mensajeError="El track elegido no existe"):a.tracks[o].puntos.length<2||a.tracks[e].puntos.length<2?(s.error=!0,s.mensajeError="Alguno de los dos tracks no dispone de al menos dos puntos creados"):e==o?(s.error=!0,s.mensajeError="Elige otro track, no puedes unir un track con el mismo"):(s.crear(0),setTimeout(function(){null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.unirTrack(e,o),r.$apply(),s.stopSpin()},100))}1==s.error&&s.stopSpin(),a.trackElegidoFinal=-1,a.trackElegidoInicial=-1,null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null)},s.borrarRuta=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,1==a.isTrack||1==a.modoCreacion||void 0===a.rutas[a.rutaActiva]?(s.error=!0,s.mensajeError="Por favor selecciona una ruta para eliminar"):a.rutas.length<1?(s.error=!0,s.mensajeError="Necesitas tener rutas creadas para poder eliminarlas"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.borrarRuta())},s.borrarWp=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.waypoints[s.wpActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un waypoint para eliminar"):a.waypoints.length<1?(s.error=!0,s.mensajeError="Necesitas tener waypoints creados para poder eliminarlos"):1==a.modoCreacion?(s.error=!0,s.mensajeError="Sal del modo creacion para poder eliminar waypoints"):(a.wpActivo=s.wpActivo,a.borrarWp())},s.verCoord=function(){a.coords?(a.coords=!1,s.coordV="ocultar coord"):(a.coords=!0,s.coordV="ver coord")},s.borrarTrack=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track para eliminar"):a.tracks.length<1?(s.error=!0,s.mensajeError="Necesitas tener tracks creados para poder eliminarlos"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.borrarTrack())},s.recortarRuta=function(){s.startSpin(),s.error=!1,s.noError=!1,a.modoInsertar=!1;var e=a.puntoElegido;1==a.isTrack||1==a.modoCreacion||void 0===a.rutas[a.rutaActiva]?(s.error=!0,s.mensajeError="Por favor selecciona una ruta para recortar"):null==a.puntoElegido?(s.error=!0,s.mensajeError="Antes de cortar tienes que seleccionar en la tabla o sobre el track el punto a partir del cual quieres realizar el corte"):s.rutas[s.rutaActiva].puntos.length<2?(s.error=!0,s.mensajeError="La ruta necesita tener mas de un punto creado para poder ser cortada"):(s.crear(1),s.crear(1),setTimeout(function(){a.puntoElegido=e,null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.recortarRuta(),r.$apply(),s.stopSpin()},100)),1==s.error&&s.stopSpin()},s.recortarTrack=function(){s.startSpin(),s.error=!1,s.noError=!1,a.modoInsertar=!1;var e=a.puntoElegido;0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track para recortar"):null==a.puntoElegido?(s.error=!0,s.mensajeError="Antes de cortar tienes que seleccionar en la tabla o sobre el track el punto a partir del cual quieres realizar el corte"):s.tracks[s.trackActivo].puntos.length<2?(s.error=!0,s.mensajeError="El track necesita tener mas de un punto creado para poder ser cortado"):(s.crear(0),s.crear(0),setTimeout(function(){a.puntoElegido=e,null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.recortarTrack(),r.$apply(),s.stopSpin()},100)),1==s.error&&s.stopSpin()},s.puntoSelecTG=function(r){a.clicTabGraf=!0,a.puntoSelec(r),a.puntoBorrado=!0},s.puntoSelec=function(r){a.puntoSelec(r),a.puntoBorrado=!0},s.puntoSelecR=function(r){a.puntoSelecR(r),a.puntoBorrado=!0},s.descripcion=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,a.waypoints.length<=0&&(s.error=!0,s.mensajeError="No tienes ningun waypoint creado"),null!=s.descrip&&a.waypoints.length>0&&a.cambiarDescripcion(s.descrip)},s.renombrarT=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,a.tracks.length<=0&&(s.error=!0,s.mensajeError="No tienes ningun track creado"),null!=s.nombre&&a.tracks.length>0&&a.renombrarT(s.nombre)},s.renombrarR=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,a.rutas.length<=0&&(s.error=!0,s.mensajeError="No tienes ninguna ruta creada"),null!=s.nombre&&a.rutas.length>0&&a.renombrarR(s.nombre)},s.renombrarW=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,a.waypoints.length<=0?(s.error=!0,s.mensajeError="No tienes ningun waypoint creado"):1==a.isTrack||void 0===a.waypoints[s.wpActivo]?(s.error=!0,s.mensajeError="No tienes ningun waypoint seleccionado"):null!=s.nombre&&a.waypoints.length>0&&a.renombrarW(s.nombre)},s.eliminarPuntoRuta=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]||1==a.modoCreacion?(s.error=!0,s.mensajeError="Por favor selecciona una ruta"):0==a.puntoBorrado||null==a.puntoElegido?(s.error=!0,s.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track  para poder borrarlo"):a.rutas[a.rutaActiva].puntos.length<1?(s.error=!0,s.mensajeError="La ruta no dispone de puntos que eliminar"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.eliminarPuntoRuta2(),a.puntoBorrado=!1,a.puntoElegido=null)},s.anadirPuntoRuta=function(){s.noError=!1,s.error=!1,1==a.modoInsertar?(a.modoInsertar=!1,s.error=!0,s.mensajeError="Acabas de salir del modo insertar punto intermedio"):1==a.isTrack||void 0===a.rutas[a.rutaActiva]?(s.error=!0,s.mensajeError="Por favor selecciona una ruta "):null==a.puntoElegido?(s.error=!0,s.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track para poder insertar a continuación"):a.rutas[a.rutaActiva].puntos.length<2?(s.error=!0,s.mensajeError="La ruta no dispone de puntos entre los que insertar"):a.puntoElegido==a.rutas[a.rutaActiva].puntos.length-1?(s.error=!0,s.mensajeError="Para añadir un punto a continuacion del ultimo simplemente haga click en el mapa, este modo es para añadir un punto intermedio"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.modoInsertar=!0,s.noError=!0,s.mensajeError="Has entrado en el modo insertar punto intermedio, para salir pulse otra vez insertar punto. Para insertar un punto haga clic en el mapa")},s.anadirPuntoTrack=function(){s.noError=!1,s.error=!1,1==a.modoInsertar?(a.modoInsertar=!1,s.error=!0,s.mensajeError="Acabas de salir del modo insertar punto intermedio"):0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track "):null==a.puntoElegido?(s.error=!0,s.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track para poder insertar a continuación"):a.tracks[a.trackActivo].puntos.length<2?(s.error=!0,s.mensajeError="El track no dispone de puntos entre los que insertar"):a.puntoElegido==a.tracks[a.trackActivo].puntos.length-1?(s.error=!0,s.mensajeError="Para añadir un punto a continuacion del ultimo simplemente haga click en el mapa, este modo es para añadir un punto intermedio"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.modoInsertar=!0,s.noError=!0,s.mensajeError="Has entrado en el modo insertar punto intermedio, para salir pulse otra vez insertar punto. Selecciona el punto de origen y después pincha donde quieras añadir el nuevo punto")},s.eliminarPuntoTrack=function(){s.noError=!1,s.error=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track "):0==a.puntoBorrado||null==a.puntoElegido?(s.error=!0,s.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track para poder borrarlo"):a.tracks[a.trackActivo].puntos.length<1?(s.error=!0,s.mensajeError="El track no dispone de puntos que eliminar"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.eliminarPuntoTrack2(),a.puntoBorrado=!1,a.puntoElegido=null)},s.invertirTrack=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track para invertir"):a.tracks[a.trackActivo].puntos.length<2?(s.error=!0,s.mensajeError="El track no dispone de puntos que invertir"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.invertirTrack2())},s.actualizarError=function(){s.error=!0,s.mensajeError="La especificación del archivo no se corresponde con la de una ruta"},s.invertirRuta=function(){s.error=!1,s.noError=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]?(s.error=!0,s.mensajeError="Por favor selecciona una ruta para invertir"):a.rutas[a.rutaActiva].puntos.length<2?(s.error=!0,s.mensajeError="La ruta no dispone de puntos que invertir"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.invertirRuta2())},s.crearWaypoint=function(){0==a.isWaypoint||void 0==a.isWaypoint?(a.isWaypoint=!0,a.isTrack=!1,s.modoCreacion=!0,a.modoCreacion=!0):(a.isWaypoint=!1,s.modoCreacion=!1,a.modoCreacion=!1)},e.bind("keydown",function(r){var e=$("#botonCrearW");1==a.modoCreacion&&"Escape"==r.key&&e.click()}),s.cargarElevaciones=function(){s.cargarElevaciones1()},s.cargarElevaciones1=function(){s.startSpin(),s.noError=!1,s.error=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track"):a.tracks[a.trackActivo].puntos.length<2?(s.error=!0,s.mensajeError="El track no dispone de puntos"):a.cargarElevaciones(function(){s.actualizarPuntosT(),r.$apply(),s.stopSpin()})},s.openPopupTiempos=function(){s.noError=!1,s.error=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(s.error=!0,s.mensajeError="Por favor selecciona un track"):(r.myJSONObjectTm={velo:a.tracks[a.trackActivo].puntos[0].velocidad},t.open({template:'<div style="height: 180px;"><label for="velocidad" class="prlabel">Velocidad:</label><input type="number"   id="velocidad" placeholder="{{ngDialogData.velo}}" ng-model="list1.velocidad" style="margin-top: 1%">min/km<label for="fecha" class="prlabel" style="margin-top: 3%">Fecha:</label><datepicker><input ng-model="date" placeholder="Puedes cambiar la hora a mano tras elegir la fecha" style="width:100%" type="text"/></datepicker><button id="actTiem" type="button" ng-click="list1.cambiarTiempos()" style="float:right;margin-top: 5% !important"  class="bttn-unite bttn-xs bttn-primary stiloBtns">Actualizar datos</button></div>',plain:!0,showClose:!0,data:r.myJSONObjectTm,controllerAs:"list1",controller:"GPSController"}))},s.cambiarTiempos=function(){if(s.error=!1,s.noError=!1,a.tracks.length>0&&1==a.isTrack){var e=s.velocidad,o=parseFloat(e),n=r.date;if(null==n||isNaN(n))n=new Date;else var n=new Date(r.date);(null==e||isNaN(e)||void 0==e)&&(e=a.tracks[a.trackActivo].puntos[0].velocidad,o=parseFloat(e)),e=60/e,n.setMonth(n.getMonth()+1),a.cambiarTiempos(parseFloat(e),n,s.trackActivo),s.actualizarPuntosT(),t.close()}},s.crear=function(r){a.trackActivo=s.trackActivo,a.rutaActiva=s.rutaActiva,1==a.isWaypoint?s.mostrarMensaje=!0:s.mostrarMensaje=!1,a.crear(r),0==r&&(1==s.mostrarTabla?s.mostrarTabla=!1:s.mostrarTabla=!0,a.puntoElegido=null,s.verTablaT()),1==r&&(1==s.mostrarTabla?s.mostrarTabla=!1:s.mostrarTabla=!0,a.puntoElegido=null,s.verTablaR())},s.anadirPuntoTForMapR=function(r,e,o){s.trackActivo=a.trackActivo,a.anadirPunto(s.numTrack,r,e,o),s.actualizarPuntosT()},s.anadirPuntoTForMapI=function(r,e){s.trackActivo=a.trackActivo,a.anadirPunto(s.numTrack,a.trackActivo,r,e),s.actualizarPuntosT()},s.anadirPuntoTForMap=function(e,o){s.trackActivo=a.trackActivo,a.anadirPunto(s.numTrack,a.trackActivo,e,o),s.actualizarPuntosT(),r.$apply()},s.anadirPuntoRForMapR=function(r,e,o){s.rutaActiva=a.rutaActiva,a.anadirPunto(s.numRuta,r,e,o),s.actualizarPuntosR()},s.anadirPuntoRForMapI=function(r,e){s.rutaActiva=a.rutaActiva,a.anadirPunto(s.numRuta,a.rutaActiva,r,e),s.actualizarPuntosR()},s.anadirPuntoRForMap=function(e,o){s.rutaActiva=a.rutaActiva,a.anadirPunto(s.numRuta,a.rutaActiva,e,o),s.actualizarPuntosR(),r.$apply()},s.changedT=function(){s.actualizarPuntosT(),a.mapa.getZoom()>=17&&a.ver&&a.actualizarMarkers2(),a.superponerPolylinea(),a.puntoElegido=null},s.changedR=function(){s.actualizarPuntosR(),a.ver&&a.actualizarMarkersR2(),a.superponerPolylineaR(),a.puntoElegido=null},s.changedW=function(){a.wpActivo=s.wpActivo,s.lng=a.waypoints[a.wpActivo].longitud,s.lat=a.waypoints[a.wpActivo].latitud},s.actualizarPuntosT=function(){a.isTrack=!0,a.isWaypoint=!1,s.modoCreacion=!1,a.modoCreacion=!1,a.trackActivo=s.trackActivo,a.actualizarPuntosT(),s.puntosTrackActivo=a.puntosTrackActivo,s.exportTabla()},s.actualizarPuntosR=function(){a.isTrack=!1,a.isWaypoint=!1,s.modoCreacion=!1,a.modoCreacion=!1,a.rutaActiva=s.rutaActiva,a.actualizarPuntosR(),s.puntosTrackActivo=a.puntosTrackActivo,s.exportTabla()},s.esIE=!!document.documentMode,s.isEdge=/Edge\/\d./i.test(navigator.userAgent),s.isChrome=!!window.chrome&&!!window.chrome.webstore,s.isFirefox="undefined"!=typeof InstallTrigger,s.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0||function(r){return"[object SafariRemoteNotification]"===r.toString()}(!window.safari||safari.pushNotification),s.esIE?(s.esIE=!0,s.isSafari=!1,s.isChrome=!1,s.isFirefox=!1,s.isEdge=!1):s.isEdge?(s.esIE=!1,s.isSafari=!1,s.isChrome=!1,s.isFirefox=!1,s.isEdge=!0):s.isChrome?(s.esIE=!1,s.isSafari=!1,s.isChrome=!0,s.isFirefox=!1,s.isEdge=!1):s.isFirefox?(s.esIE=!1,s.isSafari=!1,s.isChrome=!1,s.isFirefox=!0,s.isEdge=!1):s.isSafari&&(s.esIE=!1,s.isSafari=!0,s.isChrome=!1,s.isFirefox=!1,s.isEdge=!1),s.dowXmlForWp=function(){var r=!!document.documentMode;if(s.noError=!1,s.error=!1,a.modoInsertar=!1,s.dataUrl="",a.waypoints.length<1)s.error=!0,s.mensajeError="Necesitas tener waypoints creados para poder descargarlos";else if(r||s.isEdge){var e=a.getWaypoints();s.dataUrl="data:application/xml,"+encodeURIComponent(e),window.navigator.msSaveBlob(new Blob([e],{type:"application/xml"}),"myfile.gpx")}else if(s.isSafari){s.error=!1;var e=a.getWaypoints();s.dataUrl="data:xml/plain,"+encodeURIComponent(e),s.error=!0,s.mensajeError='Al usar safari puede que te baje sin extension,cuando lo tengas renombra el archivo y añadele la extension ".gpx"'}else{var e=a.getWaypoints();s.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e)}},s.dowXmlForR=function(){var r=!!document.documentMode;if(s.noError=!1,s.error=!1,a.modoInsertar=!1,s.dataUrl="",a.rutas.length<1)s.error=!0,s.mensajeError="Necesitas tener rutas creadas para poder descargar una";else if(1==a.isTrack||1==a.modoCreacion)s.error=!0,s.mensajeError="Por favor selecciona una ruta para descargar";else if(r||s.isEdge){var e=a.getXml(!1);s.dataUrl="data:application/xml,"+encodeURIComponent(e),window.navigator.msSaveBlob(new Blob([e],{type:"application/xml"}),"myfile.gpx")}else if(s.isSafari){s.error=!1;var e=a.getXml(!1);s.dataUrl="data:xml/plain,"+encodeURIComponent(e),s.error=!0,s.mensajeError='Al usar safari puede que te baje sin extension,cuando lo tengas renombra el archivo y añadele la extension ".gpx"'}else{var e=a.getXml(!1);s.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e)}},s.dowXml=function(){var r=!!document.documentMode;if(s.noError=!1,s.error=!1,a.modoInsertar=!1,s.dataUrl="",a.tracks.length<1)s.error=!0,s.mensajeError="Necesitas tener tracks creados para poder descargar uno";else if(0==a.isTrack)s.error=!0,s.mensajeError="Por favor selecciona un track para descargar";else if(r||s.isEdge){var e=a.getXml(!0);s.dataUrl="data:application/xml,"+encodeURIComponent(e),window.navigator.msSaveBlob(new Blob([e],{type:"application/xml"}),"myfile.gpx")}else if(s.isSafari){s.error=!1;var e=a.getXml(!0);s.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e),s.error=!0,s.mensajeError='Al usar safari puede que te baje sin extension,cuando lo tengas renombra el archivo y añadele la extension ".gpx"'}else{var e=a.getXml(!0);s.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e)}},s.dowImage=function(){console.log("hola");var r=!!document.documentMode;if(r||s.isEdge){console.log("Soy IE");var a=document.getElementById("canvas");s.dataUrl=a.toDataURL("image/webp");for(var e=atob(s.dataUrl.substring("data:image/png;base64,".length)),o=new Uint8Array(e.length),t=0,n=e.length;t<n;++t)o[t]=e.charCodeAt(t);var i=new Blob([o.buffer],{type:"image/png"});window.navigator.msSaveBlob(i,"prueba.png")}else if(s.isSafari){console.log("Soy Safaru");var a=document.getElementById("canvas");document.getElementById("btn-downloadSA");s.dataUrl=a.toDataURL("image/png")}else{var a=document.getElementById("canvas");console.log(a.toDataURL("image/png")),s.dataUrl=a.toDataURL("image/png")}},s.exportTabla=function(){var a=[];for(var e in s.puntosTrackActivo){var o={a:e,b:s.puntosTrackActivo[e].latitud,c:s.puntosTrackActivo[e].longitud,d:s.puntosTrackActivo[e].elevacion,e:s.puntosTrackActivo[e].fecha,f:s.puntosTrackActivo[e].hora,g:s.puntosTrackActivo[e].desnivel,h:s.puntosTrackActivo[e].distancia,i:s.puntosTrackActivo[e].velocidad};a.push(o)}r.getArray=a},r.getHeader=function(){return["Punto nº","Latitud","Longitud","Elevación","Fecha","Hora","Desnivel","Distancia","Velocidad"]},s.exportTablaR=function(){var a=[];for(var e in s.puntosTrackActivo){var o={a:e,b:s.puntosTrackActivo[e].latitud,c:s.puntosTrackActivo[e].longitud,d:s.puntosTrackActivo[e].elevacion,e:s.puntosTrackActivo[e].desnivel,f:s.puntosTrackActivo[e].distancia};a.push(o)}r.getArray=a},r.getHeaderR=function(){return["Punto nº","Latitud","Longitud","Elevación","Desnivel","Distancia"]},s.funciones=!1,s.funcionesR=!1,s.funcionesW=!1,s.activarLista=!1,s.activarListaR=!1,s.activarListaW=!1,s.mostrarTabla=!1,s.mostrarGrafica=!1,s.mostrarBotones=!1,s.mostrarBotonesW=!1,s.mostrarBotonesR=!1,s.mostrarAlert=!0,s.noVerAlert=function(){s.mostrarAlert=!1},s.noVerBotones=function(){s.mostrarBotones=!1,s.mostrarBotonesR=!1,s.mostrarBotonesW=!1,$("#funciones").css("width","150px")},s.verBotonesR=function(){1==s.mostrarBotonesR?(s.mostrarBotonesR=!1,$("#funciones").css("width","150px")):(s.mostrarBotonesR=!0,$("#funciones").css("width","270px"))},s.verBotonesW=function(){1==s.mostrarBotonesW?(s.mostrarBotonesW=!1,$("#funciones").css("width","150px")):(s.mostrarBotonesW=!0,$("#funciones").css("width","270px"))},s.verBotones=function(){1==s.mostrarBotones?(s.mostrarBotones=!1,$("#funciones").css("width","150px")):(s.mostrarBotones=!0,$("#funciones").css("width","270px"))},s.superponerLista=function(){$("#lista").css("z-index",2),$("#datos").css("z-index",1),$("#grafica").css("z-index",0)},s.superponerTabla=function(){$("#lista").css("z-index",0),$("#datos").css("z-index",1),$("#grafica").css("z-index",0)},s.superponerGrafica=function(){$("#datos").css("z-index",0),$("#grafica").css("z-index",1)},s.verTablaT=function(){s.tablaT=!0,s.whyCvsExport=!0,1==s.mostrarTabla?(s.mostrarTabla=!1,s.mensajeVerTabla="ver tabla"):(s.tracks.length>0&&(s.puntosTrackActivo=s.tracks[s.trackActivo].puntos,a.puntosTrackActivo=s.puntosTrackActivo,s.actualizarPuntosT()),s.mostrarTabla=!0,s.mensajeVerTabla="ocultar tabla",s.superponerTabla())},s.verTablaR=function(){s.tablaT=!1,s.whyCvsExport=!1,1==s.mostrarTabla?(s.mostrarTabla=!1,s.mensajeVerTabla="ver tabla"):(s.rutas.length>0&&(s.puntosTrackActivo=s.rutas[s.rutaActiva].puntos,a.puntosTrackActivo=s.puntosTrackActivo,s.actualizarPuntosR()),s.mostrarTabla=!0,s.mensajeVerTabla="ocultar tabla",s.superponerTabla())},s.verGrafica=function(){1==s.mostrarGrafica?(s.mostrarGrafica=!1,s.mensajeVerGrafica="ver gráfica"):(s.mostrarGrafica=!0,
s.mensajeVerGrafica="ocultar gráfica",s.superponerGrafica())},s.listaActiva=function(){s.noError=!1,s.error=!1,s.noError=!0,s.mensajeError="Has creado un track, para añadir puntos por favor pincha en el mapa",s.crear(0),s.activarListaR=!1,s.activarListaW=!1,s.activarLista=!0,s.mensajeVerlista="ocultar lista",s.mensajeVerlistaR="ver lista",s.mensajeVerlistaW="ver lista",a.actualizarMarkersR2(),setTimeout(function(){for(var r in s.tracks)r!=s.tracks.length-1?$("#in"+r).attr("checked",!1):($("#in"+r).prop("checked",!0),$("#in"+r).click())},10)},s.listaActivaR=function(){s.noError=!1,s.error=!1,s.noError=!0,s.mensajeError="Has creado una ruta, para añadir puntos por favor pincha en el mapa",s.crear(1),s.activarLista=!1,s.activarListaW=!1,s.activarListaR=!0,s.mensajeVerlista="ver lista",s.mensajeVerlistaR="ocultar lista",s.mensajeVerlistaW="ver lista",a.actualizarMarkers2(),setTimeout(function(){for(var r in s.rutas)r!=s.rutas.length-1?$("#inr"+r).attr("checked",!1):($("#inr"+r).prop("checked",!0),$("#inr"+r).click())},10)},s.listaActivaW=function(){s.activarListaR=!1,s.activarLista=!1,s.activarListaW=!0,s.mensajeVerlista="ver lista",s.mensajeVerlistaR="ver lista",s.mensajeVerlistaW="ocultar lista",s.crearWaypoint()},s.listaR=function(){s.activarListaW=!1,s.activarLista=!1,1==a.isWaypoint?s.mostrarMensaje=!0:s.mostrarMensaje=!1,1==s.activarListaR?(s.activarListaR=!1,s.mensajeVerlistaR="ver lista"):(s.activarListaR=!0,s.mensajeVerlistaR="ocultar lista",s.mensajeVerlistaW="ver lista",s.mensajeVerlista="ver lista",a.isTrack=!1,a.actualizarMarkers2(),a.actualizarMarkersR2(!0),a.puntoElegido=null,a.isWaypoint=!1,1==s.mostrarTabla?s.mostrarTabla=!1:s.mostrarTabla=!0,s.verTablaR()),setTimeout(function(){for(var r in a.rutas)$("#lir"+r)[0].style.color=a.polyLineasR[r].strokeColor},10)},s.listaW=function(){s.activarListaR=!1,s.activarLista=!1,1==s.activarListaW?(s.activarListaW=!1,s.mensajeVerlistaW="ver lista"):(s.activarListaW=!0,s.mensajeVerlistaW="ocultar lista",s.mensajeVerlistaR="ver lista",s.mensajeVerlista="ver lista",a.isWaypoint=!1)},s.listaT=function(){s.activarListaR=!1,s.activarListaW=!1,1==a.isWaypoint?s.mostrarMensaje=!0:s.mostrarMensaje=!1,1==s.activarLista?(s.activarLista=!1,s.mensajeVerlista="ver lista"):(s.activarLista=!0,s.mensajeVerlista="ocultar lista",s.mensajeVerlistaR="ver lista",s.mensajeVerlistaW="ver lista",a.isTrack=!0,a.actualizarMarkersR2(),a.actualizarMarkers2(!0),a.puntoElegido=null,a.isWaypoint=!1,s.modoCreacion=!1,a.modoCreacion=!1,1==s.mostrarTabla?s.mostrarTabla=!1:s.mostrarTabla=!0,s.verTablaT()),setTimeout(function(){for(var r in a.tracks)$("#li"+r)[0].style.color=a.polyLineas[r].strokeColor},10)},s.listarFunciones=function(){s.funcionesR=!1,s.funcionesW=!1,s.mostrarBotones=!1,s.mostrarBotonesR=!1,s.mostrarBotonesW=!1,1==s.funciones?s.funciones=!1:(s.funciones=!0,a.isTrackImport=!0,a.isRuteImport=!1,a.isWpImport=!1)},s.listarFuncionesR=function(){s.funciones=!1,s.funcionesW=!1,s.mostrarBotones=!1,s.mostrarBotonesR=!1,s.mostrarBotonesW=!1,1==s.funcionesR?s.funcionesR=!1:(s.funcionesR=!0,a.isTrackImport=!1,a.isRuteImport=!0,a.isWpImport=!1)},s.listarFuncionesW=function(){s.funciones=!1,s.funcionesR=!1,s.mostrarBotones=!1,s.mostrarBotonesR=!1,s.mostrarBotonesW=!1,1==s.funcionesW?s.funcionesW=!1:(s.funcionesW=!0,a.isTrackImport=!1,a.isRuteImport=!1,a.isWpImport=!0)}}angular.module("GPS").controller("GPSController",r).config(function(r){r.setForceHtmlReload(!0),r.setForceBodyReload(!0)}),r.$inject=["$scope","EntidadesService","$document","usSpinnerService","ngDialog","$window","$location"]})();