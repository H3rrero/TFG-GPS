(function(){"use strict";function r(r,a,e,o,t){var n=this;n.trackActivo=0,n.rutaActiva=0,n.wpActivo=0,n.numTrack=0,n.numRuta=1,n.numWaypoint=2,n.tracks=a.tracks,n.rutas=a.rutas,n.waypoints=a.waypoints,n.puntosTrackActivo=a.puntosTrackActivo,n.modoCreacion=!1,a.modoCreacion=!1,n.mostrarMensaje=!1,n.mensajeError="",n.error=!1,n.puntoBorrado=!1,n.fichero,n.noError=!1,n.mensajeVerTabla="ver tabla",n.mensajeVerGrafica="ver gráfica",n.mensajeVerlista="ver lista",n.mensajeVerlistaR="ver lista",n.mensajeVerlistaW="ver lista",n.modoEdicion=a.modoEdicion,n.apiMaps=!0,n.conection=!1,n.coordV="ocultar coor",n.verMarker="ocultar pts",n.tablaT=!1,n.escala="5km",n.capturaUrl="",n.pant=!0,n.whyCvsExport=!1,n.colorTrack="",n.nombre="",n.descrip="",r.color="#FF0000",n.grosor=0,n.lng="",n.lat="",n.lngNW,n.latNW,n.velocidad,n.fecha,n.cuenta=2,r.options={format:"hex"},r.eventApi={onChange:function(r,e,o){a.isTrack?(a.changedColor(e),$("#li"+a.trackNombre)[0].style.color=e):(a.changedColorR(e),$("#lir"+a.rutaNombre)[0].style.color=e)}},n.desSubrayar=function(r){$("#pt"+r)[0].style=""},n.subrayar=function(r){$("#pt"+r)[0].style="text-decoration: underline; cursor:pointer;"},n.desSubrayarr=function(r){$("#pr"+r)[0].style=""},n.subrayarr=function(r){$("#pr"+r)[0].style="text-decoration: underline; cursor:pointer;"},n.desSubrayarw=function(r){$("#pw"+r)[0].style=""},n.subrayarw=function(r){$("#pw"+r)[0].style="text-decoration: underline; cursor:pointer;"},n.openPopup=function(e){n.noError=!1,n.error=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track"):n.tracks[n.trackActivo].puntos.length<2?(n.error=!0,n.mensajeError="El track necesita tener al menos dos puntos para que exista una polilinea a la cual cambiar el color"):(a.trackNombre=e,r.myJSONObject={name:a.tracks[e].nombre},setTimeout(function(){t.open({template:'<div style="height: 210px;"><label for="nombre" class="prlabel">Nombre:</label><input type="text"   id="nombre" style="width: 100%;" placeholder="{{ngDialogData.name}}" ng-model="list1.nombre" ng-change="list1.renombrarT()"><label for="grosor" class="prlabel" style="margin-top: 1%;">Grosor:</label><input type="number"   id="grosor" style="width: 100%;" ng-model="list1.grosor" ng-change="list1.cambiarGrosor()"><label for="picker" class="prlabel" style="margin-top: 1%;">Color:</label><color-picker id="picker" ng-model="color" options="options"  event-api="eventApi" ></color-picker><button id="botoncerrardialog" type="button"  style="right: 0 !important;position: absolute; bottom: 4%;" ng-click="closeThisDialog(0)" class="bttn-unite bttn-xs bttn-primary stiloBtns">cerrar</button></div>',plain:!0,closeByEscape:!0,controllerAs:"list1",data:r.myJSONObject,controller:"GPSController"})},10))},n.openPopupR=function(e){n.noError=!1,n.error=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]||1==a.modoCreacion?(n.error=!0,n.mensajeError="Por favor selecciona una ruta"):n.rutas[n.rutaActiva].puntos.length<2?(n.error=!0,n.mensajeError="La ruta necesita tener al menos dos puntos para que exista una polilinea a la cual cambiar las propiedades"):(a.rutaNombre=e,r.myJSONObjectR={name:a.rutas[e].nombre},t.open({template:'<div style="height: 210px;"><label for="nombre" class="prlabel">Nombre:</label><input type="text"   id="nombre" style="width: 100%;" placeholder="{{ngDialogData.name}}" ng-model="list1.nombre" ng-change="list1.renombrarR()"><label for="grosor" class="prlabel" style="margin-top: 1%;">Grosor:</label><input type="number"   id="grosor" style="width: 100%;" ng-model="list1.grosor" ng-change="list1.cambiarGrosorR()"><label for="grosor" class="prlabel" style="margin-top: 1%;">Color:</label><color-picker id="picker" ng-model="color" options="options"  event-api="eventApi" ></color-picker><button id="botoncerrardialogR" type="button"  style="right: 0 !important;position: absolute; bottom: 4%;" ng-click="closeThisDialog(0)" class="bttn-unite bttn-xs bttn-primary stiloBtns">cerrar</button></div>',plain:!0,data:r.myJSONObjectR,controllerAs:"list1",controller:"GPSController"}))},n.openPopupW=function(e){n.noError=!1,n.error=!1,1==a.isTrack||void 0===a.waypoints[n.wpActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un waypoint"):a.waypoints.length<1?(n.error=!0,n.mensajeError="Necesitas tener waypoints creados para poder editarlos"):(a.wptNombre=e,r.myJSONObjectW={name:a.waypoints[e].nombre,desc:a.waypoints[e].descripcion,lat:a.waypoints[e].latitud,lng:a.waypoints[e].longitud},t.open({template:'<div style="height: 215px;"><label for="nombre" class="prlabel">Nombre:</label><input type="text"   id="nombre" style="width: 100%;" placeholder="{{ngDialogData.name}}" ng-model="list1.nombre" ng-change="list1.renombrarW()"><label for="descripcion" class="prlabel" style="margin-top: 1%;">Descripción:</label><input type="text"   id="descripcion" style="width: 100%;" placeholder="{{ngDialogData.desc}}"  ng-model="list1.descrip" ng-change="list1.descripcion()"><label for="coord" class="prlabel" style="margin-top: 1%;">Latitud y longitud:</label><input type="text"   id="coord" style="width: 45%;" placeholder="{{ngDialogData.lat}}"  ng-model="list1.lat" ng-change="list1.changeMarkerPosition()" ><input type="text"  style="margin-left: 2%;width: 45%;"  placeholder="{{ngDialogData.lng}}"   id="coordlng" ng-model="list1.lng" ng-change="list1.changeMarkerPosition()" ><button id="cerrarwp" type="button" ng-click="closeThisDialog(0)" style="float:right;margin-top: 5% !important"  class="bttn-unite bttn-xs bttn-primary stiloBtns">cerrar</button></div>',plain:!0,data:r.myJSONObjectW,controllerAs:"list1",controller:"GPSController"}))},n.openPopupNW=function(){t.open({template:'<label for="coord" class="prlabel">Latitud y longitud:</label><input type="text"   id="coord" style="width: 45%;"  placeholder="43.324228"   ng-model="list1.latNW" ><input type="text"  style="margin-left: 2%;width: 45%;"  placeholder="-5.629051"  id="coordlng" ng-model="list1.lngNW" ><button id="botonAnadirWp" type="button"  style="margin-top: 4% !important" ng-click="list1.anadirWaypoint()" class="bttn-unite bttn-xs bttn-success stiloBtns">crear</button>',plain:!0,showClose:!0,controllerAs:"list1",controller:"GPSController"})},n.anadirWaypoint=function(){n.activarListaR=!1,n.activarLista=!1,n.activarListaW=!0,n.mensajeVerlista="ver lista",n.mensajeVerlistaR="ver lista",n.mensajeVerlistaW="ocultar lista",a.isWaypoint=!0,a.isTrack=!1,n.modoCreacion=!0,a.modoCreacion=!0,null!=n.latNW&&null!=n.lngNW&&a.anadirWaypoint(n.latNW,n.lngNW),t.close()},n.cambiarGrosor=function(){null!=n.grosor&&n.grosor>0&&a.tracks.length>0&&a.grosor(n.grosor)},n.changeMarkerPosition=function(){null!=n.lat&&null!=n.lng&&a.waypoints.length>0&&a.changeMarkerPosition(n.lat,n.lng)},n.cambiarGrosorR=function(){null!=n.grosor&&n.grosor>0&&a.rutas.length>0&&a.grosorR(n.grosor)},n.startSpin=function(){o.spin("spinner-1")},n.stopSpin=function(){o.stop("spinner-1")},angular.element(document).ready(function(){setTimeout(n.actuTamano,500)}),n.actuTamano=function(){n.gr=$("#map"),n.gr.children().children().children()[16].style.right="220px",n.gr.children().children().children()[16].childNodes[1].childNodes[0].style.fontSize="16px",n.gr.children().children().children()[16].childNodes[1].childNodes[0].style.fontWeight="bold"},n.vermarkers=function(){a.ver?(a.ver=!1,n.verMarker="ver pts",a.vermarkers()):(a.ver=!0,n.verMarker="ocultar pts",a.vermarkers())},n.capPant=function(a){if(n.pant){n.capturaUrl="",n.startSpin();var e=$("div.tile");if(n.isChrome||n.isFirefox)for(var o in e)o<e.length&&(e[o].style.borderWidth="2px");html2canvas($(".gm-style")[0].childNodes[0],{useCORS:!0,onrendered:function(e){if(n.isFirefox&&(n.pant=!1,n.capturaUrl=e.toDataURL("image/jpg"),n.pant=!1,r.$apply(),n.stopSpin(),a?$("#downPt").click():$("#downPtR").click()),n.esIE||n.isEdge){n.capturaUrl=e.toDataURL("image/webp");for(var o=atob(n.capturaUrl.substring("data:image/png;base64,".length)),t=new Uint8Array(o.length),i=0,s=o.length;i<s;++i)t[i]=o.charCodeAt(i);var l=new Blob([t.buffer],{type:"image/png"});window.navigator.msSaveBlob(l,"prueba.png"),n.stopSpin()}n.isSafari&&(n.capturaUrl=e.toDataURL("image/png"),$("#btn-downloadTS").attr("href",n.capturaUrl),n.stopSpin()),n.isChrome&&(n.capturaUrl=e.toDataURL("image/jpg"),n.stopSpin(),window.open(n.capturaUrl))}});for(var o in e)o<e.length&&(e[o].style.borderWidth="1px")}else n.pant=!0},n.modoEdicionF=function(){n.noError=!1,n.error=!1,1==n.modoEdicion?(n.error=!0,n.modoEdicion=!1,a.modoEdicion=!1,n.mensajeError="Has desativado el modo edición"):(n.noError=!0,n.mensajeError="Has activado el modo edición",n.modoEdicion=!0,a.modoEdicion=!0)},n.activarImportWp=function(){n.error=!1,void 0==a.xmlImportado?(n.error=!0,n.mensajeError="Antes de importar selecciona un archivo con el boton seleccione fichero "):a.importXMLWp()},n.activarImportRuta=function(){n.error=!1,void 0==a.xmlImportado?(n.error=!0,n.mensajeError="Antes de importar selecciona un archivo con el boton seleccione fichero "):(n.crear(1),a.importXML())},n.activarImport=function(){n.error=!1,void 0==a.xmlImportado?(n.error=!0,n.mensajeError="Antes de importar selecciona un archivo con el boton seleccione fichero "):(n.crear(0),a.importXML())},n.unirRutas=function(){if(n.startSpin(),n.noError=!1,n.error=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]||1==a.modoCreacion)n.error=!0,n.mensajeError="Por favor muestra la lista de rutas(ver lista) para activar el modo ruta y poder acceder a sus funcionalidades";else if(a.rutas.length<2)n.error=!0,n.mensajeError="Se necesitan al menos dos rutas para poder realizar la unión";else if(a.rutaElegidoInicial==-1||a.rutaElegidoFinal==-1)n.error=!0,n.mensajeError="Debes seleccionar el punto final de la primera ruta de la uniónn y el punto inicial de la segunda ruta de la unión y despues darle a unir";else{var e=a.rutaElegidoInicial,o=a.rutaElegidoFinal;null==e||void 0==a.rutas[e]?(n.error=!0,n.mensajeError="La ruta elegida no existe"):a.rutas[o].puntos.length<2||a.rutas[e].puntos.length<2?(n.error=!0,n.mensajeError="Alguna de las dos rutas no dispone de al menos dos puntos creados"):e==o?(n.error=!0,n.mensajeError="Elige otra ruta, no se puede unir una ruta con ella misma"):(n.crear(1),setTimeout(function(){null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.unirRuta(e,o),r.$apply(),n.stopSpin()},100))}1==n.error&&n.stopSpin(),a.rutaElegidoFinal=-1,a.rutaElegidoInicial=-1,null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null)},n.unirTracks=function(){if(n.startSpin(),n.noError=!1,n.error=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo])n.error=!0,n.mensajeError="Por favor muestra la lista de tracks(ver lista) para activar el modo track y poder acceder a sus funcionalidades";else if(a.tracks.length<2)n.error=!0,n.mensajeError="Se necesitan al menos dos tracks para poder realizar la unión";else if(a.trackElegidoInicial==-1||a.trackElegidoFinal==-1)n.error=!0,n.mensajeError="Debes seleccionar el punto final del primer track de la uniónn y el punto inicial del segundo track de la unión y despues darle a unir";else{var e=a.trackElegidoInicial,o=a.trackElegidoFinal;null==e||void 0==a.tracks[e]?(n.error=!0,n.mensajeError="El track elegido no existe"):a.tracks[o].puntos.length<2||a.tracks[e].puntos.length<2?(n.error=!0,n.mensajeError="Alguno de los dos tracks no dispone de al menos dos puntos creados"):e==o?(n.error=!0,n.mensajeError="Elige otro track, no puedes unir un track con el mismo"):(n.crear(0),setTimeout(function(){null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.unirTrack(e,o),r.$apply(),n.stopSpin()},100))}1==n.error&&n.stopSpin(),a.trackElegidoFinal=-1,a.trackElegidoInicial=-1,null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null)},n.borrarRuta=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,1==a.isTrack||1==a.modoCreacion||void 0===a.rutas[a.rutaActiva]?(n.error=!0,n.mensajeError="Por favor selecciona una ruta para eliminar"):a.rutas.length<1?(n.error=!0,n.mensajeError="Necesitas tener rutas creadas para poder eliminarlas"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.borrarRuta())},n.borrarWp=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.waypoints[n.wpActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un waypoint para eliminar"):a.waypoints.length<1?(n.error=!0,n.mensajeError="Necesitas tener waypoints creados para poder eliminarlos"):1==a.modoCreacion?(n.error=!0,n.mensajeError="Sal del modo creacion para poder eliminar waypoints"):(a.wpActivo=n.wpActivo,a.borrarWp())},n.verCoord=function(){a.coords?(a.coords=!1,n.coordV="ocultar coord"):(a.coords=!0,n.coordV="ver coord")},n.borrarTrack=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track para eliminar"):a.tracks.length<1?(n.error=!0,n.mensajeError="Necesitas tener tracks creados para poder eliminarlos"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.borrarTrack())},n.recortarRuta=function(){n.startSpin(),n.error=!1,n.noError=!1,a.modoInsertar=!1;var e=a.puntoElegido;1==a.isTrack||1==a.modoCreacion||void 0===a.rutas[a.rutaActiva]?(n.error=!0,n.mensajeError="Por favor selecciona una ruta para recortar"):null==a.puntoElegido?(n.error=!0,n.mensajeError="Antes de cortar tienes que seleccionar en la tabla o sobre el track el punto a partir del cual quieres realizar el corte"):n.rutas[n.rutaActiva].puntos.length<2?(n.error=!0,n.mensajeError="La ruta necesita tener mas de un punto creado para poder ser cortada"):(n.crear(1),n.crear(1),setTimeout(function(){a.puntoElegido=e,null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.recortarRuta(),r.$apply(),n.stopSpin()},100)),1==n.error&&n.stopSpin()},n.recortarTrack=function(){n.startSpin(),n.error=!1,n.noError=!1,a.modoInsertar=!1;var e=a.puntoElegido;0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track para recortar"):null==a.puntoElegido?(n.error=!0,n.mensajeError="Antes de cortar tienes que seleccionar en la tabla o sobre el track el punto a partir del cual quieres realizar el corte"):n.tracks[n.trackActivo].puntos.length<2?(n.error=!0,n.mensajeError="El track necesita tener mas de un punto creado para poder ser cortado"):(n.crear(0),n.crear(0),setTimeout(function(){a.puntoElegido=e,null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.recortarTrack(),r.$apply(),n.stopSpin()},100)),1==n.error&&n.stopSpin()},n.puntoSelecTG=function(r){a.clicTabGraf=!0,a.puntoSelec(r),a.puntoBorrado=!0},n.puntoSelec=function(r){a.puntoSelec(r),a.puntoBorrado=!0},n.puntoSelecR=function(r){a.puntoSelecR(r),a.puntoBorrado=!0},n.descripcion=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,a.waypoints.length<=0&&(n.error=!0,n.mensajeError="No tienes ningun waypoint creado"),null!=n.descrip&&a.waypoints.length>0&&a.cambiarDescripcion(n.descrip)},n.renombrarT=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,a.tracks.length<=0&&(n.error=!0,n.mensajeError="No tienes ningun track creado"),null!=n.nombre&&a.tracks.length>0&&a.renombrarT(n.nombre)},n.renombrarR=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,a.rutas.length<=0&&(n.error=!0,n.mensajeError="No tienes ninguna ruta creada"),null!=n.nombre&&a.rutas.length>0&&a.renombrarR(n.nombre)},n.renombrarW=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,a.waypoints.length<=0?(n.error=!0,n.mensajeError="No tienes ningun waypoint creado"):1==a.isTrack||void 0===a.waypoints[n.wpActivo]?(n.error=!0,n.mensajeError="No tienes ningun waypoint seleccionado"):null!=n.nombre&&a.waypoints.length>0&&a.renombrarW(n.nombre)},n.eliminarPuntoRuta=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]||1==a.modoCreacion?(n.error=!0,n.mensajeError="Por favor selecciona una ruta"):0==a.puntoBorrado||null==a.puntoElegido?(n.error=!0,n.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track  para poder borrarlo"):a.rutas[a.rutaActiva].puntos.length<1?(n.error=!0,n.mensajeError="La ruta no dispone de puntos que eliminar"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.eliminarPuntoRuta2(),a.puntoBorrado=!1,a.puntoElegido=null)},n.anadirPuntoRuta=function(){n.noError=!1,n.error=!1,1==a.modoInsertar?(a.modoInsertar=!1,n.error=!0,n.mensajeError="Acabas de salir del modo insertar punto intermedio"):1==a.isTrack||void 0===a.rutas[a.rutaActiva]?(n.error=!0,n.mensajeError="Por favor selecciona una ruta "):null==a.puntoElegido?(n.error=!0,n.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track para poder insertar a continuación"):a.rutas[a.rutaActiva].puntos.length<2?(n.error=!0,n.mensajeError="La ruta no dispone de puntos entre los que insertar"):a.puntoElegido==a.rutas[a.rutaActiva].puntos.length-1?(n.error=!0,n.mensajeError="Para añadir un punto a continuacion del ultimo simplemente haga click en el mapa, este modo es para añadir un punto intermedio"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.modoInsertar=!0,n.noError=!0,n.mensajeError="Has entrado en el modo insertar punto intermedio, para salir pulse otra vez insertar punto. Para insertar un punto haga clic en el mapa")},n.anadirPuntoTrack=function(){n.noError=!1,n.error=!1,1==a.modoInsertar?(a.modoInsertar=!1,n.error=!0,n.mensajeError="Acabas de salir del modo insertar punto intermedio"):0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track "):null==a.puntoElegido?(n.error=!0,n.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track para poder insertar a continuación"):a.tracks[a.trackActivo].puntos.length<2?(n.error=!0,n.mensajeError="El track no dispone de puntos entre los que insertar"):a.puntoElegido==a.tracks[a.trackActivo].puntos.length-1?(n.error=!0,n.mensajeError="Para añadir un punto a continuacion del ultimo simplemente haga click en el mapa, este modo es para añadir un punto intermedio"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.modoInsertar=!0,n.noError=!0,n.mensajeError="Has entrado en el modo insertar punto intermedio, para salir pulse otra vez insertar punto. Selecciona el punto de origen y después pincha donde quieras añadir el nuevo punto")},n.eliminarPuntoTrack=function(){n.noError=!1,n.error=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track "):0==a.puntoBorrado||null==a.puntoElegido?(n.error=!0,n.mensajeError="Debes seleccionar un punto en la tabla de puntos o sobre el track para poder borrarlo"):a.tracks[a.trackActivo].puntos.length<1?(n.error=!0,n.mensajeError="El track no dispone de puntos que eliminar"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.eliminarPuntoTrack2(),a.puntoBorrado=!1,a.puntoElegido=null)},n.invertirTrack=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track para invertir"):a.tracks[a.trackActivo].puntos.length<2?(n.error=!0,n.mensajeError="El track no dispone de puntos que invertir"):(null!=a.trackElegidoFinalMarker&&a.trackElegidoFinalMarker.setMap(null),null!=a.trackElegidoInicialMarker&&a.trackElegidoInicialMarker.setMap(null),a.invertirTrack2())},n.actualizarError=function(){n.error=!0,n.mensajeError="La especificación del archivo no se corresponde con la de una ruta"},n.invertirRuta=function(){n.error=!1,n.noError=!1,a.modoInsertar=!1,1==a.isTrack||void 0===a.rutas[a.rutaActiva]?(n.error=!0,n.mensajeError="Por favor selecciona una ruta para invertir"):a.rutas[a.rutaActiva].puntos.length<2?(n.error=!0,n.mensajeError="La ruta no dispone de puntos que invertir"):(null!=a.rutaElegidoFinalMarker&&a.rutaElegidoFinalMarker.setMap(null),null!=a.rutaElegidoInicialMarker&&a.rutaElegidoInicialMarker.setMap(null),a.invertirRuta2())},n.crearWaypoint=function(){0==a.isWaypoint||void 0==a.isWaypoint?(a.isWaypoint=!0,a.isTrack=!1,n.modoCreacion=!0,a.modoCreacion=!0):(a.isWaypoint=!1,n.modoCreacion=!1,a.modoCreacion=!1)},e.bind("keydown",function(r){var e=$("#botonCrearW");1==a.modoCreacion&&"Escape"==r.key&&e.click()}),n.cargarElevaciones=function(){n.cargarElevaciones1()},n.cargarElevaciones1=function(){n.startSpin(),n.noError=!1,n.error=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track"):a.tracks[a.trackActivo].puntos.length<2?(n.error=!0,n.mensajeError="El track no dispone de puntos"):(a.cargarElevaciones(),setTimeout(function(){n.actualizarPuntosT(),r.$apply(),n.stopSpin()},2e3))},n.openPopupTiempos=function(){n.noError=!1,n.error=!1,0==a.isTrack||void 0===a.tracks[a.trackActivo]?(n.error=!0,n.mensajeError="Por favor selecciona un track"):(r.myJSONObjectTm={velo:a.tracks[a.trackActivo].puntos[0].velocidad},t.open({template:'<div style="height: 180px;"><label for="velocidad" class="prlabel">Velocidad:</label><input type="number"   id="velocidad" placeholder="{{ngDialogData.velo}}" ng-model="list1.velocidad" style="margin-top: 1%">min/km<label for="fecha" class="prlabel" style="margin-top: 3%">Fecha:</label><datepicker><input ng-model="date" placeholder="Puedes cambiar la hora a mano tras elegir la fecha" style="width:100%" type="text"/></datepicker><button id="actTiem" type="button" ng-click="list1.cambiarTiempos()" style="float:right;margin-top: 5% !important"  class="bttn-unite bttn-xs bttn-primary stiloBtns">Actualizar datos</button></div>',plain:!0,showClose:!0,data:r.myJSONObjectTm,controllerAs:"list1",controller:"GPSController"}))},n.cambiarTiempos=function(){if(n.error=!1,n.noError=!1,a.tracks.length>0&&1==a.isTrack){var e=n.velocidad,o=parseFloat(e),i=r.date;if(null==i||isNaN(i))i=new Date;else var i=new Date(r.date);(null==e||isNaN(e)||void 0==e)&&(e=a.tracks[a.trackActivo].puntos[0].velocidad,o=parseFloat(e)),e=60/e,i.setMonth(i.getMonth()+1),a.cambiarTiempos(parseFloat(e),i,n.trackActivo),n.actualizarPuntosT(),t.close()}},n.crear=function(r){a.trackActivo=n.trackActivo,a.rutaActiva=n.rutaActiva,1==a.isWaypoint?n.mostrarMensaje=!0:n.mostrarMensaje=!1,a.crear(r),0==r&&(1==n.mostrarTabla?n.mostrarTabla=!1:n.mostrarTabla=!0,a.puntoElegido=null,n.verTablaT()),1==r&&(1==n.mostrarTabla?n.mostrarTabla=!1:n.mostrarTabla=!0,a.puntoElegido=null,n.verTablaR())},n.anadirPuntoTForMapR=function(r,e,o){n.trackActivo=a.trackActivo,a.anadirPunto(n.numTrack,r,e,o)},n.anadirPuntoTForMapI=function(r,e){n.trackActivo=a.trackActivo,a.anadirPunto(n.numTrack,a.trackActivo,r,e),n.actualizarPuntosT()},n.anadirPuntoTForMap=function(e,o){n.trackActivo=a.trackActivo,a.anadirPunto(n.numTrack,a.trackActivo,e,o),n.actualizarPuntosT(),r.$apply()},n.anadirPuntoRForMapR=function(r,e,o){n.rutaActiva=a.rutaActiva,a.anadirPunto(n.numRuta,r,e,o),n.actualizarPuntosR()},n.anadirPuntoRForMapI=function(r,e){n.rutaActiva=a.rutaActiva,a.anadirPunto(n.numRuta,a.rutaActiva,r,e),n.actualizarPuntosR()},n.anadirPuntoRForMap=function(e,o){n.rutaActiva=a.rutaActiva,a.anadirPunto(n.numRuta,a.rutaActiva,e,o),n.actualizarPuntosR(),r.$apply()},n.changedT=function(){n.actualizarPuntosT(),a.mapa.getZoom()>=17&&a.ver&&a.actualizarMarkers2(),a.superponerPolylinea(),a.puntoElegido=null},n.changedR=function(){n.actualizarPuntosR(),a.ver&&a.actualizarMarkersR2(),a.superponerPolylineaR(),a.puntoElegido=null},n.changedW=function(){a.wpActivo=n.wpActivo,n.lng=a.waypoints[a.wpActivo].longitud,n.lat=a.waypoints[a.wpActivo].latitud},n.actualizarPuntosT=function(){a.isTrack=!0,a.isWaypoint=!1,n.modoCreacion=!1,a.modoCreacion=!1,a.trackActivo=n.trackActivo,a.actualizarPuntosT(),n.puntosTrackActivo=a.puntosTrackActivo,n.exportTabla()},n.actualizarPuntosR=function(){a.isTrack=!1,a.isWaypoint=!1,n.modoCreacion=!1,a.modoCreacion=!1,a.rutaActiva=n.rutaActiva,a.actualizarPuntosR(),n.puntosTrackActivo=a.puntosTrackActivo,n.exportTabla()},n.esIE=!!document.documentMode,n.isEdge=/Edge\/\d./i.test(navigator.userAgent),n.isChrome=!!window.chrome&&!!window.chrome.webstore,n.isFirefox="undefined"!=typeof InstallTrigger,n.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0||function(r){return"[object SafariRemoteNotification]"===r.toString()}(!window.safari||safari.pushNotification),n.esIE?(n.esIE=!0,n.isSafari=!1,n.isChrome=!1,n.isFirefox=!1,n.isEdge=!1):n.isEdge?(n.esIE=!1,n.isSafari=!1,n.isChrome=!1,n.isFirefox=!1,n.isEdge=!0):n.isChrome?(n.esIE=!1,n.isSafari=!1,n.isChrome=!0,n.isFirefox=!1,n.isEdge=!1):n.isFirefox?(n.esIE=!1,n.isSafari=!1,n.isChrome=!1,n.isFirefox=!0,n.isEdge=!1):n.isSafari&&(n.esIE=!1,n.isSafari=!0,n.isChrome=!1,n.isFirefox=!1,n.isEdge=!1),n.dowXmlForWp=function(){var r=!!document.documentMode;if(n.noError=!1,n.error=!1,a.modoInsertar=!1,n.dataUrl="",a.waypoints.length<1)n.error=!0,n.mensajeError="Necesitas tener waypoints creados para poder descargarlos";else if(r||n.isEdge){var e=a.getWaypoints();n.dataUrl="data:application/xml,"+encodeURIComponent(e),window.navigator.msSaveBlob(new Blob([e],{type:"application/xml"}),"myfile.gpx")}else if(n.isSafari){n.error=!1;var e=a.getWaypoints();n.dataUrl="data:xml/plain,"+encodeURIComponent(e),n.error=!0,n.mensajeError='Al usar safari puede que te baje sin extension,cuando lo tengas renombra el archivo y añadele la extension ".gpx"'}else{var e=a.getWaypoints();n.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e)}},n.dowXmlForR=function(){var r=!!document.documentMode;if(n.noError=!1,n.error=!1,a.modoInsertar=!1,n.dataUrl="",a.rutas.length<1)n.error=!0,n.mensajeError="Necesitas tener rutas creadas para poder descargar una";else if(1==a.isTrack||1==a.modoCreacion)n.error=!0,n.mensajeError="Por favor selecciona una ruta para descargar";else if(r||n.isEdge){var e=a.getXml(!1);n.dataUrl="data:application/xml,"+encodeURIComponent(e),window.navigator.msSaveBlob(new Blob([e],{type:"application/xml"}),"myfile.gpx")}else if(n.isSafari){n.error=!1;var e=a.getXml(!1);n.dataUrl="data:xml/plain,"+encodeURIComponent(e),n.error=!0,n.mensajeError='Al usar safari puede que te baje sin extension,cuando lo tengas renombra el archivo y añadele la extension ".gpx"'}else{var e=a.getXml(!1);n.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e)}},n.dowXml=function(){var r=!!document.documentMode;if(n.noError=!1,n.error=!1,a.modoInsertar=!1,n.dataUrl="",a.tracks.length<1)n.error=!0,n.mensajeError="Necesitas tener tracks creados para poder descargar uno";else if(0==a.isTrack)n.error=!0,n.mensajeError="Por favor selecciona un track para descargar";else if(r||n.isEdge){var e=a.getXml(!0);n.dataUrl="data:application/xml,"+encodeURIComponent(e),window.navigator.msSaveBlob(new Blob([e],{type:"application/xml"}),"myfile.gpx")}else if(n.isSafari){n.error=!1;var e=a.getXml(!0);n.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e),n.error=!0,n.mensajeError='Al usar safari puede que te baje sin extension,cuando lo tengas renombra el archivo y añadele la extension ".gpx"'}else{var e=a.getXml(!0);n.dataUrl="data:xml/plain;charset=utf-8,"+encodeURIComponent(e)}},n.dowImage=function(){var r=!!document.documentMode;if(r||n.isEdge){var a=document.getElementById("canvas");n.dataUrl=a.toDataURL("image/webp");for(var e=atob(n.dataUrl.substring("data:image/png;base64,".length)),o=new Uint8Array(e.length),t=0,i=e.length;t<i;++t)o[t]=e.charCodeAt(t);var s=new Blob([o.buffer],{type:"image/png"});window.navigator.msSaveBlob(s,"prueba.png")}else if(n.isSafari){var a=document.getElementById("canvas");document.getElementById("btn-downloadSA");n.dataUrl=a.toDataURL("image/png")}else{var a=document.getElementById("canvas");n.dataUrl=a.toDataURL("image/png")}},n.exportTabla=function(){var a=[];for(var e in n.puntosTrackActivo){var o={a:e,b:n.puntosTrackActivo[e].latitud,c:n.puntosTrackActivo[e].longitud,d:n.puntosTrackActivo[e].elevacion,e:n.puntosTrackActivo[e].fecha,f:n.puntosTrackActivo[e].hora,g:n.puntosTrackActivo[e].desnivel,h:n.puntosTrackActivo[e].distancia,i:n.puntosTrackActivo[e].velocidad};a.push(o)}r.getArray=a},r.getHeader=function(){return["Punto nº","Latitud","Longitud","Elevación","Fecha","Hora","Desnivel","Distancia","Velocidad"]},n.exportTablaR=function(){var a=[];for(var e in n.puntosTrackActivo){var o={a:e,b:n.puntosTrackActivo[e].latitud,c:n.puntosTrackActivo[e].longitud,d:n.puntosTrackActivo[e].elevacion,e:n.puntosTrackActivo[e].desnivel,f:n.puntosTrackActivo[e].distancia};a.push(o)}r.getArray=a},r.getHeaderR=function(){return["Punto nº","Latitud","Longitud","Elevación","Desnivel","Distancia"]},n.funciones=!1,n.funcionesR=!1,n.funcionesW=!1,n.activarLista=!1,n.activarListaR=!1,n.activarListaW=!1,n.mostrarTabla=!1,n.mostrarGrafica=!1,n.mostrarBotones=!1,n.mostrarBotonesW=!1,n.mostrarBotonesR=!1,n.mostrarAlert=!0,n.noVerAlert=function(){n.mostrarAlert=!1},n.noVerBotones=function(){n.mostrarBotones=!1,n.mostrarBotonesR=!1,n.mostrarBotonesW=!1,$("#funciones").css("width","150px")},n.verBotonesR=function(){1==n.mostrarBotonesR?(n.mostrarBotonesR=!1,$("#funciones").css("width","150px")):(n.mostrarBotonesR=!0,$("#funciones").css("width","270px"))},n.verBotonesW=function(){1==n.mostrarBotonesW?(n.mostrarBotonesW=!1,$("#funciones").css("width","150px")):(n.mostrarBotonesW=!0,$("#funciones").css("width","270px"))},n.verBotones=function(){1==n.mostrarBotones?(n.mostrarBotones=!1,$("#funciones").css("width","150px")):(n.mostrarBotones=!0,$("#funciones").css("width","270px"))},n.superponerLista=function(){$("#lista").css("z-index",2),$("#datos").css("z-index",1),$("#grafica").css("z-index",0)},n.superponerTabla=function(){$("#lista").css("z-index",0),$("#datos").css("z-index",1),$("#grafica").css("z-index",0)},n.superponerGrafica=function(){$("#datos").css("z-index",0),$("#grafica").css("z-index",1)},n.verTablaT=function(){n.tablaT=!0,n.whyCvsExport=!0,1==n.mostrarTabla?(n.mostrarTabla=!1,n.mensajeVerTabla="ver tabla"):(n.tracks.length>0&&(n.puntosTrackActivo=n.tracks[n.trackActivo].puntos,a.puntosTrackActivo=n.puntosTrackActivo,n.actualizarPuntosT()),n.mostrarTabla=!0,n.mensajeVerTabla="ocultar tabla",n.superponerTabla())},n.verTablaR=function(){n.tablaT=!1,n.whyCvsExport=!1,1==n.mostrarTabla?(n.mostrarTabla=!1,n.mensajeVerTabla="ver tabla"):(n.rutas.length>0&&(n.puntosTrackActivo=n.rutas[n.rutaActiva].puntos,a.puntosTrackActivo=n.puntosTrackActivo,n.actualizarPuntosR()),n.mostrarTabla=!0,n.mensajeVerTabla="ocultar tabla",n.superponerTabla())},n.verGrafica=function(){1==n.mostrarGrafica?(n.mostrarGrafica=!1,n.mensajeVerGrafica="ver gráfica"):(n.mostrarGrafica=!0,n.mensajeVerGrafica="ocultar gráfica",n.superponerGrafica())},n.listaActiva=function(){n.noError=!1,n.error=!1,n.noError=!0,n.mensajeError="Has creado un track, para añadir puntos por favor pincha en el mapa",n.crear(0),n.activarListaR=!1,n.activarListaW=!1,n.activarLista=!0,n.mensajeVerlista="ocultar lista",n.mensajeVerlistaR="ver lista",n.mensajeVerlistaW="ver lista",
a.actualizarMarkersR2(),setTimeout(function(){for(var r in n.tracks)r!=n.tracks.length-1?$("#in"+r).attr("checked",!1):($("#in"+r).prop("checked",!0),$("#in"+r).click())},10)},n.listaActivaR=function(){n.noError=!1,n.error=!1,n.noError=!0,n.mensajeError="Has creado una ruta, para añadir puntos por favor pincha en el mapa",n.crear(1),n.activarLista=!1,n.activarListaW=!1,n.activarListaR=!0,n.mensajeVerlista="ver lista",n.mensajeVerlistaR="ocultar lista",n.mensajeVerlistaW="ver lista",a.actualizarMarkers2(),setTimeout(function(){for(var r in n.rutas)r!=n.rutas.length-1?$("#inr"+r).attr("checked",!1):($("#inr"+r).prop("checked",!0),$("#inr"+r).click())},10)},n.listaActivaW=function(){n.activarListaR=!1,n.activarLista=!1,n.activarListaW=!0,n.mensajeVerlista="ver lista",n.mensajeVerlistaR="ver lista",n.mensajeVerlistaW="ocultar lista",n.crearWaypoint()},n.listaR=function(){n.activarListaW=!1,n.activarLista=!1,1==a.isWaypoint?n.mostrarMensaje=!0:n.mostrarMensaje=!1,1==n.activarListaR?(n.activarListaR=!1,n.mensajeVerlistaR="ver lista"):(n.activarListaR=!0,n.mensajeVerlistaR="ocultar lista",n.mensajeVerlistaW="ver lista",n.mensajeVerlista="ver lista",a.isTrack=!1,a.actualizarMarkers2(),a.actualizarMarkersR2(),a.puntoElegido=null,a.isWaypoint=!1,1==n.mostrarTabla?n.mostrarTabla=!1:n.mostrarTabla=!0,n.verTablaR()),setTimeout(function(){for(var r in a.rutas)$("#lir"+r)[0].style.color=a.polyLineasR[r].strokeColor},10)},n.listaW=function(){n.activarListaR=!1,n.activarLista=!1,1==n.activarListaW?(n.activarListaW=!1,n.mensajeVerlistaW="ver lista"):(n.activarListaW=!0,n.mensajeVerlistaW="ocultar lista",n.mensajeVerlistaR="ver lista",n.mensajeVerlista="ver lista",a.isWaypoint=!1)},n.listaT=function(){n.activarListaR=!1,n.activarListaW=!1,1==a.isWaypoint?n.mostrarMensaje=!0:n.mostrarMensaje=!1,1==n.activarLista?(n.activarLista=!1,n.mensajeVerlista="ver lista"):(n.activarLista=!0,n.mensajeVerlista="ocultar lista",n.mensajeVerlistaR="ver lista",n.mensajeVerlistaW="ver lista",a.isTrack=!0,a.actualizarMarkersR2(),a.actualizarMarkers2(),a.puntoElegido=null,a.isWaypoint=!1,n.modoCreacion=!1,a.modoCreacion=!1,1==n.mostrarTabla?n.mostrarTabla=!1:n.mostrarTabla=!0,n.verTablaT()),setTimeout(function(){for(var r in a.tracks)$("#li"+r)[0].style.color=a.polyLineas[r].strokeColor},10)},n.listarFunciones=function(){n.funcionesR=!1,n.funcionesW=!1,n.mostrarBotones=!1,n.mostrarBotonesR=!1,n.mostrarBotonesW=!1,1==n.funciones?n.funciones=!1:(n.funciones=!0,a.isTrackImport=!0,a.isRuteImport=!1,a.isWpImport=!1)},n.listarFuncionesR=function(){n.funciones=!1,n.funcionesW=!1,n.mostrarBotones=!1,n.mostrarBotonesR=!1,n.mostrarBotonesW=!1,1==n.funcionesR?n.funcionesR=!1:(n.funcionesR=!0,a.isTrackImport=!1,a.isRuteImport=!0,a.isWpImport=!1)},n.listarFuncionesW=function(){n.funciones=!1,n.funcionesR=!1,n.mostrarBotones=!1,n.mostrarBotonesR=!1,n.mostrarBotonesW=!1,1==n.funcionesW?n.funcionesW=!1:(n.funcionesW=!0,a.isTrackImport=!1,a.isRuteImport=!1,a.isWpImport=!0)}}angular.module("GPS").controller("GPSController",r).config(function(r){r.setForceHtmlReload(!0),r.setForceBodyReload(!0)})})();